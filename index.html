<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SHIN-UI-SON - 10ìˆ˜ (4íšŒì°¨, ìƒìœ„6+í•˜ìœ„4, íŠ¹ìˆ˜ê·œì¹™)</title>
    <style>
        :root { --gold: #ffd700; --bg: #0b0b0b; --card: #1a1a1a; --accent: #00ffcc; --save: #ff00ff; --danger: #ff4444; }
        body { background-color: var(--bg); color: var(--gold); font-family: 'Malgun Gothic', sans-serif; padding: 8px; margin: 0; }
        .outer-border { border: 2px solid var(--gold); border-radius: 20px; padding: 12px; max-width: 480px; margin: 0 auto; }
        .header-box { text-align: center; margin-bottom: 8px; }
        
        .prev-win-label { font-size: 10px; color: #aaa; margin-bottom: 2px; }
        .next-episode { font-size: 18px; font-weight: 900; color: #fff; text-shadow: 0 0 8px rgba(255,215,0,0.5); margin-bottom: 2px; }
        .round-text { font-size: 20px; font-weight: 900; color: #ffd700; text-shadow: 0 0 12px #ffd700; margin: 0 0 2px 0; }
        
        .base-info { display: flex; flex-wrap: wrap; gap: 3px; justify-content: center; align-items: center; margin: 5px 0; }
        .base-num-box { width: 24px; height: 24px; line-height: 24px; text-align: center; font-size: 10px; font-weight: 900; border-radius: 50%; background: #000000; color: var(--gold); border: 1px solid var(--gold); display: inline-block; }
        .bonus-label { color: #888; font-size: 8px; margin: 0 2px; }
        
        .status-info { font-size: 10px; color: var(--accent); line-height: 1.3; min-height: 65px; width: 100%; background: rgba(255,255,255,0.05); border-radius: 12px; padding: 6px; box-sizing: border-box; margin-top: 5px; text-align: left; border: 1px solid #333; overflow-y: auto; }
        .highlight-gold { color: var(--gold); font-weight: bold; }
        .highlight-blue { color: #00ccff; font-weight: bold; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin: 3px 0; }
        button { border-radius: 8px; font-weight: bold; cursor: pointer; border: none; height: 40px; transition: 0.2s; font-size: 14px; }
        button:active { transform: scale(0.95); opacity: 0.8; }
        .btn-5set { background: linear-gradient(135deg, #00ffcc, #00a884); color: #000; }
        .btn-main { background: linear-gradient(135deg, #ffd700, #b8860b); color: #000; }
        .btn-sub { background: #222; color: #fff; border: 1px solid #444; }
        .btn-reset { grid-column: span 2; background: #333; color: #aaa; height: 34px; margin-top: 3px; font-size: 13px; }
        .btn-review { grid-column: span 2; background: #ff00ff; color: white; height: 38px; margin-top: 3px; }
        
        .round-selector { margin: 3px 0 0 0; text-align: center; border-top: 1px solid #333; padding-top: 5px; }
        .round-selector label { display: block; font-size: 12px; color: var(--accent); margin-bottom: 3px; font-weight: bold; }
        .base-round-input { display: flex; justify-content: center; align-items: center; gap: 5px; }
        .base-round-input input { width: 70px; height: 34px; text-align: center; background: #222; border: 2px solid var(--gold); color: #fff; border-radius: 8px; font-size: 14px; font-weight: bold; }
        .base-round-input button { background: var(--accent); color: #000; border: none; border-radius: 8px; padding: 0 10px; height: 34px; font-weight: bold; font-size: 13px; cursor: pointer; box-shadow: 0 0 6px rgba(0,255,204,0.3); }
        .round-desc { font-size: 9px; color: #888; margin-top: 2px; }
        
        .row-line { background: var(--card); border-radius: 10px; padding: 8px; margin-bottom: 6px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #333; cursor: pointer; transition: 0.2s; }
        .row-line:hover { border-color: var(--accent); }
        .num-container { display: flex; gap: 4px; flex-grow: 1; justify-content: center; }
        
        .num-box { width: 28px; height: 28px; line-height: 28px; text-align: center; font-size: 11px; font-weight: 900; border-radius: 50%; background: #000000 !important; color: var(--gold) !important; border: 1px solid var(--gold) !important; }
        .num-box.eliminated { border-color: #ff8888 !important; color: #ff8888 !important; }
        
        .combo-label { font-size: 13px; font-weight: bold; color: var(--accent); margin-right: 6px; min-width: 40px; }
        .save-btn { font-size: 10px; background: var(--save); color: white; padding: 4px 6px; border-radius: 5px; cursor: pointer; margin-left: 6px; }
        .badge { font-size: 9px; background: #333; padding: 2px 4px; border-radius: 8px; margin-left: 4px; color: #aaa; }
        
        .popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .popup-content { background: var(--card); border: 2px solid var(--gold); border-radius: 18px; padding: 15px; max-width: 420px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative; }
        .popup-close { position: absolute; top: 8px; right: 12px; font-size: 24px; background: transparent; border: none; color: var(--gold); cursor: pointer; z-index: 1100; padding: 5px 10px; }
        .popup-title { font-size: 17px; font-weight: bold; margin-bottom: 12px; text-align: center; color: var(--gold); }
        
        .user-info { background: #333; color: var(--accent); padding: 2px 6px; border-radius: 16px; font-size: 10px; margin-bottom: 5px; text-align: center; display: inline-block; }
        .change-name-btn { background: #00ccff; color: white; border: none; border-radius: 4px; padding: 2px 5px; font-size: 9px; margin-left: 4px; cursor: pointer; }
        
        .small-note { margin-top: 2px; color: #888; font-size: 8px; text-align: center; }
        *:focus, *:active { outline: none; -webkit-tap-highlight-color: transparent; }
        
        .game-tabs { display: flex; gap: 4px; margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 4px; }
        .game-tab { flex: 1; background: #222; color: #aaa; border: 1px solid #444; border-radius: 5px; padding: 5px 0; font-size: 12px; cursor: pointer; }
        .game-tab.active { background: var(--accent); color: #000; font-weight: bold; border-color: var(--accent); }
        .game-panel { display: none; }
        .game-panel.active { display: block; }
        .game-canvas { width: 100%; height: 220px; background: #1a1a1a; border-radius: 10px; border: 1px solid #444; margin: 5px 0; touch-action: none; }
        .selected-numbers { display: flex; gap: 5px; justify-content: center; margin: 6px 0; flex-wrap: wrap; }
        .selected-ball { width: 32px; height: 32px; border-radius: 50%; background: #000; border: 2px solid var(--gold); color: var(--gold); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 13px; }
        .game-btn-group { display: flex; gap: 6px; justify-content: center; margin-top: 6px; }
        .game-btn { background: var(--accent); color: #000; border: none; border-radius: 6px; padding: 6px 12px; font-weight: bold; cursor: pointer; font-size: 13px; height: auto; }
        .game-btn:disabled { opacity: 0.5; background: #444; color: #aaa; cursor: not-allowed; transform: none; }
        .reaction-box { width: 100%; height: 130px; background: #222; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 15px; cursor: pointer; margin: 8px 0; }
        .reaction-result { margin-top: 6px; font-size: 13px; color: var(--gold); text-align: center; }
        
        .winning-input { display: flex; gap: 4px; justify-content: center; margin: 10px 0; flex-wrap: wrap; }
        .winning-input input { width: 36px; height: 36px; text-align: center; background: #222; border: 1px solid #444; color: #fff; border-radius: 5px; font-size: 13px; }
        .result-box { background: #222; border: 1px solid #444; border-radius: 8px; padding: 8px; margin: 8px 0; font-size: 12px; }
        .match-count { font-size: 15px; color: var(--gold); }
        .combo-item { display: flex; justify-content: space-between; padding: 4px; border-bottom: 1px solid #333; font-size: 11px; }
        .winning-display { font-size: 12px; color: #ffd700; margin-bottom: 8px; text-align: center; }
        
        .section-row { display: flex; align-items: center; margin: 4px 0; padding: 4px; background: #1a1a1a; border-radius: 5px; }
        .section-label { width: 45px; color: var(--accent); font-size: 11px; }
        .section-nums { display: flex; gap: 3px; flex-wrap: wrap; }
        
        .combo-list { max-height: 350px; overflow-y: auto; }
        .combo-item-row { display: flex; justify-content: space-between; align-items: center; padding: 5px; border-bottom: 1px solid #333; }
        .combo-item-row:last-child { border-bottom: none; }
        .combo-nums { display: flex; gap: 3px; }
        .combo-save-btn { background: var(--save); color: white; border: none; border-radius: 4px; padding: 3px 6px; font-size: 9px; cursor: pointer; }
        .combo-save-btn:active { transform: scale(0.95); opacity: 0.8; }

        /* ë³µê¸° íŒì—… ë‚´ AI ì •ë³´ ì˜ì—­ */
        .ai-info-box { background: #1a1a1a; border-radius: 6px; padding: 6px; margin: 8px 0; font-size: 11px; border: 1px solid #444; }
        .ai-info-box div { margin: 2px 0; }
        /* ì¼ì¹˜í•˜ëŠ” ë²ˆí˜¸ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .matched { color: #00ff00 !important; font-weight: bold; }
    </style>
</head>
<body>
<div class="outer-border">
    <div class="header-box">
        <div class="prev-win-label" id="prevWinLabel">ğŸ“Œ ê¸°ì¤€ ì´ì „íšŒì°¨ ë‹¹ì²¨ë²ˆí˜¸</div>
        <div class="base-info" id="baseRoundInfo"></div>
        <div class="next-episode">SHIN-UI-SON + 10ìˆ˜ (4íšŒì°¨, ìƒìœ„6+í•˜ìœ„4)</div>
        <div class="round-text" id="roundDisplay">ì˜ˆìƒ íšŒì°¨</div>
        <div id="userDisplay" class="user-info"></div>
        <div id="status" class="status-info">ì—”ì§„ ì´ˆê¸°í™” ì¤‘...</div>
    </div>

    <div class="round-selector">
        <label>ğŸ¯ ë¶„ì„í•  íšŒì°¨ ì„ íƒ</label>
        <div class="base-round-input">
            <input type="number" id="baseRoundInput" min="901" max="1300" value="1213" step="1">
            <button onclick="setBaseRound()">ì„¤ì •</button>
        </div>
        <div class="round-desc">(900~1212 ë°ì´í„° ê¸°ë°˜)</div>
    </div>

    <div class="btn-group">
        <button class="btn-5set" onclick="process(5)">5ì¡°í•© ì¶”ì¶œ</button>
        <button class="btn-main" onclick="process(10)">10ì¡°í•© ì¶”ì¶œ</button>
        <button class="btn-sub" onclick="openPopup()">ë³´ê´€í•¨</button>
        <button class="btn-sub" onclick="openGamePopup()">ğŸ® ê²Œì„ì„¼í„°</button>
        <button class="btn-sub" onclick="clearStorage()">ì´ˆê¸°í™”</button>
        <button class="btn-sub btn-reset" onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn-review" onclick="openReviewPopup()">ğŸ“Š ë³µê¸°</button>
        <button class="btn-sub" onclick="showComboList()">ğŸ“‹ ì¡°í•© ëª©ë¡</button>
    </div>

    <div id="console"></div>
    <div class="small-note">â€» 10ì¡°í•©: í™€ìˆ˜ì¡°í•©(1,3,5,7,9) 14ìˆ˜, ì§ìˆ˜ì¡°í•©(2,4,6,8,10) 10ìˆ˜ | 5ì¡°í•©: 10ìˆ˜ ê°€ì¤‘ì¹˜ ëœë¤ | ğŸ¯ <span id="targetRound">1213</span>íšŒì°¨ ì˜ˆìƒ</div>
</div>

<!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ -->
<div id="toast" style="position:fixed; bottom:20px; left:0; width:100%; text-align:center; z-index:9999; display:none; pointer-events:none;">
    <span style="background:#333; color:#ffd700; padding:5px 10px; border-radius:18px; font-size:11px; box-shadow:0 2px 6px rgba(0,0,0,0.3); display:inline-block;">âœ… ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤</span>
</div>

<!-- íŒì—…ë“¤ -->
<div id="popup" class="popup-overlay" style="display:none;">
    <div class="popup-content">
        <button class="popup-close" onclick="closePopup()">&times;</button>
        <div class="popup-title">ğŸ“¦ ë³´ê´€í•¨</div>
        <div id="storage"></div>
    </div>
</div>

<div id="gamePopup" class="popup-overlay" style="display:none;">
    <div class="popup-content" style="max-width: 420px;">
        <button class="popup-close" onclick="closeGamePopup()" ontouchstart="event.stopPropagation(); closeGamePopup();">&times;</button>
        <div class="popup-title">ğŸ® ê²Œì„ì„¼í„°</div>
        <div class="game-tabs">
            <button class="game-tab active" data-game="touch" onclick="switchGame('touch')" ontouchstart="event.stopPropagation(); switchGame('touch');">í„°ì¹˜ ëŸ¬ì‰¬</button>
            <button class="game-tab" data-game="reaction" onclick="switchGame('reaction')" ontouchstart="event.stopPropagation(); switchGame('reaction');">ë°˜ì‘ì†ë„</button>
        </div>
        <div id="touchGame" class="game-panel active">
            <canvas id="gameCanvas" class="game-canvas"></canvas>
            <div class="selected-numbers" id="selectedNumbersContainer"></div>
            <div style="font-size:8px; color:#888; text-align:center;">* 6ê°œë¥¼ ì„ íƒí•˜ë©´ ì €ì¥ ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤</div>
            <div class="game-btn-group">
                <button class="game-btn" onclick="resetTouchGame()" ontouchstart="event.stopPropagation(); resetTouchGame();">ë¦¬ì…‹</button>
                <button class="game-btn" id="saveComboBtn" onclick="saveTouchCombo()" ontouchstart="event.stopPropagation(); saveTouchCombo();" disabled>ì¡°í•© ì €ì¥</button>
            </div>
        </div>
        <div id="reactionGame" class="game-panel">
            <div style="text-align: center; margin: 8px 0;">
                <div class="reaction-box" id="reactionBox" onclick="handleReactionClick()" ontouchstart="event.stopPropagation(); handleReactionClick();">ì‹œì‘í•˜ë ¤ë©´ ëˆ„ë¥´ì„¸ìš”</div>
                <div class="reaction-result" id="reactionResult"></div>
                <div class="selected-numbers" id="reactionSelectedContainer"></div>
                <div style="font-size:8px; color:#888; text-align:center;">* 6ê°œë¥¼ ì„ íƒí•˜ë©´ ì €ì¥ ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤</div>
                <div class="game-btn-group">
                    <button class="game-btn" onclick="resetReactionGame()" ontouchstart="event.stopPropagation(); resetReactionGame();">ë¦¬ì…‹</button>
                    <button class="game-btn" id="saveReactionBtn" onclick="saveReactionCombo()" ontouchstart="event.stopPropagation(); saveReactionCombo();" disabled>ì¡°í•© ì €ì¥</button>
                    <button class="game-btn" onclick="startReaction()" ontouchstart="event.stopPropagation(); startReaction();">ìƒˆ ê²Œì„</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="reviewPopup" class="popup-overlay" style="display:none;">
    <div class="popup-content">
        <button class="popup-close" onclick="closeReviewPopup()">&times;</button>
        <div class="popup-title" id="reviewTitle">ğŸ“Š 1213íšŒ ë³µê¸°</div>
        <div class="winning-display" id="winningDisplay"></div>
        
        <!-- í˜„ì¬ AI 10ìˆ˜ ë° ìƒì¡´ì ì •ë³´ í‘œì‹œ ì˜ì—­ (ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨) -->
        <div class="ai-info-box" id="reviewAIInfo">
            <!-- analyze()ì—ì„œ ì±„ì›€ (ë¹„êµí•˜ê¸° ëˆ„ë¥´ë©´ ì—…ë°ì´íŠ¸) -->
        </div>

        <div style="text-align: center; margin-bottom: 8px;" id="reviewDesc">ë‹¹ì²¨ë²ˆí˜¸ 6ê°œ + ë³´ë„ˆìŠ¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
        <div class="winning-input">
            <input type="number" id="win1" min="1" max="45" step="1" placeholder="1">
            <input type="number" id="win2" min="1" max="45" step="1" placeholder="2">
            <input type="number" id="win3" min="1" max="45" step="1" placeholder="3">
            <input type="number" id="win4" min="1" max="45" step="1" placeholder="4">
            <input type="number" id="win5" min="1" max="45" step="1" placeholder="5">
            <input type="number" id="win6" min="1" max="45" step="1" placeholder="6">
        </div>
        <div style="text-align: center; margin: 5px 0;">ë³´ë„ˆìŠ¤ ë²ˆí˜¸</div>
        <div class="winning-input">
            <input type="number" id="bonus" min="1" max="45" step="1" placeholder="ë³´ë„ˆìŠ¤">
        </div>
        <div style="text-align: center; margin: 8px 0;">
            <button class="game-btn" onclick="compareNumbers()">ë¹„êµí•˜ê¸°</button>
        </div>
        <div id="reviewResult" class="result-box">
            <div>AI ì¶”ì²œ 10ìˆ˜ì™€ ë¹„êµ:</div>
            <div id="aiMatch" class="match-count">-</div>
            <div id="aiMatchedList" style="font-size: 12px; color: #ffd700;"></div>
            <div id="aiBonus" style="font-size: 12px; color: #aaa;"></div>
            <div style="margin-top: 6px;">ë³´ê´€í•¨ ì¡°í•© ë¹„êµ:</div>
            <div id="savedMatch" style="max-height: 140px; overflow-y: auto;"></div>
        </div>
    </div>
</div>

<div id="comboDetailPopup" class="popup-overlay" style="display:none;">
    <div class="popup-content">
        <button class="popup-close" onclick="closeComboDetailPopup()">&times;</button>
        <div class="popup-title" id="comboDetailTitle">ì¡°í•© ìƒì„¸</div>
        <div id="comboDetailContent"></div>
    </div>
</div>

<!-- ì¡°í•© ëª©ë¡ íŒì—… (ëª¨ë‘ ì €ì¥ ë²„íŠ¼ í¬í•¨) -->
<div id="comboListPopup" class="popup-overlay" style="display:none;">
    <div class="popup-content">
        <button class="popup-close" onclick="closeComboListPopup()">&times;</button>
        <div class="popup-title">ğŸ“‹ ìƒì„±ëœ ì¡°í•©</div>
        <div style="text-align: right; margin-bottom: 8px;">
            <button class="combo-save-btn" onclick="saveAllCombos()" style="background:#00ccff; color:#000; font-size:10px; padding:4px 8px;">ğŸ“¥ ëª¨ë‘ ì €ì¥</button>
        </div>
        <div id="comboListContent" class="combo-list"></div>
    </div>
</div>

<script>
    // ===== 900~1212íšŒì°¨ ì „ì²´ ë°ì´í„° =====
    const FULL_DATA = [ [1212,5,8,25,31,41,44,45], [1211,23,26,27,35,38,40,10], [1210,1,7,9,17,27,38,31], [1209,2,17,20,35,37,39,24], [1208,6,27,30,36,38,42,25], [1207,10,22,24,27,38,45,11], [1206,1,3,17,26,27,42,23], [1205,1,4,16,23,31,41,2], [1204,8,16,28,30,31,44,27], [1203,3,6,18,29,35,39,24], [1202,5,12,21,33,37,40,7], [1201,7,9,24,27,35,36,37], [1200,1,2,4,16,20,32,45], [1199,16,24,25,30,31,32,7], [1198,26,30,33,38,39,41,21], [1197,1,5,7,26,28,43,30], [1196,8,12,15,29,40,45,14], [1195,3,15,27,33,34,36,37], [1194,3,13,15,24,33,37,2], [1193,6,9,16,19,24,28,17], [1192,10,16,23,36,39,40,11], [1191,1,4,11,12,20,41,2], [1190,7,9,19,23,26,45,33], [1189,9,19,29,35,37,38,31], [1188,3,4,12,19,22,27,9], [1187,5,13,26,29,37,40,42], [1186,2,8,13,16,23,28,35], [1185,6,17,22,28,29,32,38], [1184,14,16,23,25,31,37,42], [1183,4,15,17,23,27,36,31], [1182,1,13,21,25,28,31,22], [1181,8,10,14,20,33,41,28], [1180,6,12,18,37,40,41,3], [1179,3,16,18,24,40,44,21], [1178,5,6,11,27,43,44,17], [1177,3,7,15,16,19,43,21], [1176,7,9,11,21,30,35,29], [1175,3,4,6,8,32,42,31], [1174,8,11,14,17,36,39,22], [1173,1,5,18,20,30,35,3], [1172,7,9,24,40,42,44,45], [1171,3,6,7,11,12,17,19], [1170,3,13,28,34,38,42,25], [1169,5,12,24,26,39,42,20], [1168,9,21,24,30,33,37,29], [1167,8,23,31,35,39,40,24], [1166,14,23,25,27,29,42,16], [1165,6,7,27,29,38,45,17], [1164,17,18,23,25,38,39,22], [1163,2,13,15,16,33,43,4], [1162,20,21,22,25,28,29,6], [1161,2,12,20,24,34,42,37], [1160,7,13,18,36,39,45,19], [1159,3,9,27,28,38,39,7], [1158,21,25,27,32,37,38,20], [1157,5,7,12,20,25,26,28], [1156,30,31,34,39,41,45,7], [1155,10,16,19,27,37,38,13], [1154,4,8,22,26,32,38,27], [1153,1,9,10,13,35,44,5], [1152,30,31,32,35,36,37,5], [1151,2,3,9,15,27,29,8], [1150,8,9,18,35,39,45,25], [1149,8,15,19,21,32,36,38], [1148,3,6,13,15,16,22,32], [1147,7,11,24,26,27,37,32], [1146,6,11,17,19,40,43,28], [1145,2,11,31,33,37,44,32], [1144,3,4,12,15,26,34,6], [1143,10,16,17,27,28,36,6], [1142,2,8,28,30,37,41,22], [1141,7,11,12,21,26,35,20], [1140,7,10,22,29,31,38,15], [1139,5,12,15,30,37,40,18], [1138,14,16,19,20,29,34,35], [1137,4,9,12,15,33,45,26], [1136,21,33,35,38,42,44,1], [1135,1,6,13,19,21,33,4], [1134,3,7,9,13,19,24,23], [1133,13,14,20,28,29,34,23], [1132,6,7,19,28,34,41,5], [1131,1,2,6,14,27,38,33], [1130,15,19,21,25,27,28,40], [1129,5,10,11,17,28,34,22], [1128,1,5,8,16,28,33,45], [1127,10,15,24,30,31,37,32], [1126,4,5,9,11,37,40,7], [1125,6,14,25,33,40,44,30], [1124,3,8,17,30,33,34,28], [1123,13,19,21,24,34,35,26], [1122,3,6,21,30,34,35,22], [1121,6,24,31,32,38,44,8], [1120,2,19,26,31,38,41,34], [1119,1,9,12,13,20,45,3], [1118,11,13,14,15,16,45,3], [1117,3,4,9,30,33,36,7], [1116,15,16,17,25,30,31,32], [1115,7,12,23,32,34,36,8], [1114,10,16,19,32,33,38,3], [1113,11,13,20,21,32,44,8], [1112,16,20,26,36,42,44,24], [1111,3,13,30,33,43,45,4], [1110,3,7,11,20,22,41,24], [1109,10,12,13,19,33,40,2], [1108,7,19,26,37,39,44,27], [1107,6,14,30,31,40,41,29], [1106,1,3,4,29,42,45,36], [1105,6,16,34,37,39,40,11], [1104,1,7,21,30,35,38,2], [1103,10,12,29,31,40,44,2], [1102,13,14,22,26,37,38,20], [1101,6,7,13,28,36,42,41], [1100,17,26,29,30,31,43,12], [1099,3,20,28,38,40,43,4], [1098,12,16,21,24,41,43,15], [1097,14,33,34,35,37,40,4], [1096,1,12,16,19,23,43,34], [1095,8,14,28,29,34,40,12], [1094,6,7,15,22,26,40,41], [1093,10,17,22,30,35,43,44], [1092,7,18,19,26,33,45,37], [1091,6,20,23,24,28,30,44], [1090,12,19,21,29,40,45,1], [1089,4,18,31,37,42,43,40], [1088,11,21,22,30,39,44,31], [1087,13,14,18,21,34,44,16], [1086,11,16,25,27,35,36,37], [1085,4,7,17,18,38,44,36], [1084,8,12,13,29,33,42,5], [1083,3,7,14,15,22,38,17], [1082,21,26,27,32,34,42,31], [1081,1,9,16,23,24,38,17], [1080,13,16,23,31,36,44,38], [1079,4,8,18,24,37,45,6], [1078,6,10,11,14,36,38,43], [1077,4,8,17,30,40,43,34], [1076,3,7,9,33,36,37,10], [1075,1,23,24,35,44,45,10], [1074,1,6,20,27,28,41,15], [1073,6,18,28,30,32,38,15], [1072,16,18,20,23,32,43,27], [1071,1,2,11,21,30,35,39], [1070,3,6,14,22,30,41,36], [1069,1,10,18,22,28,31,44], [1068,4,7,19,26,33,35,3], [1067,7,10,19,23,28,33,18], [1066,6,11,16,19,21,32,45], [1065,3,18,19,23,32,45,24], [1064,3,6,9,18,22,35,14], [1063,3,6,22,23,24,38,30], [1062,20,31,32,40,41,45,12], [1061,4,24,27,35,37,45,15], [1060,3,10,24,33,38,45,36], [1059,7,10,22,25,34,40,27], [1058,11,23,25,30,32,40,42], [1057,8,13,19,27,40,45,12], [1056,13,20,24,32,36,45,29], [1055,4,7,12,14,22,33,31], [1054,14,19,27,28,30,45,33], [1053,22,26,29,30,34,45,15], [1052,5,17,26,27,35,38,1], [1051,21,26,30,32,33,35,44], [1050,6,12,31,35,38,43,17], [1049,3,5,13,20,21,37,17], [1048,6,12,17,21,32,39,30], [1047,2,20,33,40,42,44,32], [1046,7,16,25,29,35,36,28], [1045,6,14,15,19,21,41,37], [1044,12,17,20,26,28,36,4], [1043,3,5,12,22,26,31,19], [1042,5,14,15,23,34,43,4], [1041,6,7,9,11,17,18,45], [1040,8,16,26,29,31,36,11], [1039,2,3,6,19,36,39,26], [1038,7,16,24,27,37,44,2], [1037,2,14,15,22,27,33,31], [1036,2,5,22,32,34,45,39], [1035,9,14,34,35,41,42,2], [1034,26,31,32,33,38,40,11], [1033,3,11,15,20,35,44,10], [1032,1,6,12,19,36,42,28], [1031,6,7,22,32,35,36,19], [1030,2,5,11,17,24,29,9], [1029,12,30,32,37,39,41,24], [1028,5,7,12,13,18,35,23], [1027,14,16,27,35,39,45,5], [1026,5,12,13,31,32,41,34], [1025,8,9,20,25,29,33,7], [1024,9,18,20,22,38,44,10], [1023,10,14,16,18,29,35,25], [1022,5,6,11,29,42,45,28], [1021,12,15,17,24,29,45,16], [1020,12,27,29,38,41,45,6], [1019,1,4,13,17,34,39,6], [1018,3,19,21,25,37,45,35], [1017,12,18,22,23,30,34,32], [1016,15,26,28,34,41,42,44], [1015,14,23,31,33,37,40,44], [1014,3,11,14,18,26,27,21], [1013,21,22,26,34,36,41,32], [1012,5,11,18,20,35,45,3], [1011,1,9,12,26,35,38,42], [1010,9,12,15,25,34,36,3], [1009,15,23,29,34,40,44,20], [1008,9,11,30,31,41,44,33], [1007,8,11,16,19,21,25,40], [1006,8,11,15,16,17,37,36], [1005,8,13,18,24,27,29,17], [1004,7,15,30,37,39,44,18], [1003,1,4,29,39,43,45,31], [1002,17,25,33,35,38,45,15], [1001,6,10,12,14,20,42,15], [1000,2,8,19,22,32,42,39], [999,1,3,9,14,18,28,34], [998,13,17,18,20,42,45,41], [997,4,7,14,16,24,44,20], [996,6,11,15,24,32,39,28], [995,1,4,13,29,38,39,7], [994,1,3,8,24,27,35,28], [993,6,14,16,18,24,42,44], [992,12,20,26,33,44,45,24], [991,13,18,25,31,33,44,38], [990,2,4,25,26,36,37,28], [989,17,18,21,27,29,33,26], [988,2,13,20,30,31,41,27], [987,2,4,15,23,29,38,7], [986,7,10,16,28,41,42,40], [985,17,21,23,30,34,44,19], [984,3,10,23,35,36,37,18], [983,13,23,26,31,35,43,15], [982,5,7,13,20,21,44,33], [981,27,36,37,41,43,45,32], [980,3,13,16,23,24,35,14], [979,7,11,16,21,27,33,24], [978,1,7,15,32,34,42,8], [977,2,9,10,14,22,44,16], [976,4,12,14,25,35,37,2], [975,7,8,9,17,22,24,5], [974,1,2,11,16,39,44,32], [973,22,26,31,37,41,42,24], [972,3,6,17,23,37,39,26], [971,2,6,17,18,21,26,7], [970,9,11,16,21,28,36,5], [969,3,9,10,29,40,45,7], [968,2,5,12,14,24,39,33], [967,1,6,13,37,38,40,9], [966,1,21,25,29,34,37,36], [965,2,13,25,28,29,36,34], [964,6,21,36,38,39,43,30], [963,6,12,19,23,34,42,35], [962,1,18,28,31,34,43,40], [961,11,20,29,31,33,42,43], [960,2,18,24,30,32,45,14], [959,1,14,15,24,40,41,35], [958,2,9,10,16,35,37,1], [957,4,15,24,35,36,40,1], [956,10,11,20,21,25,41,40], [955,4,9,23,26,29,33,8], [954,1,9,26,28,30,41,32], [953,7,9,22,27,37,42,34], [952,4,12,22,24,33,41,38], [951,2,12,30,31,39,43,38], [950,3,4,15,22,28,40,10], [949,14,21,35,36,40,44,30], [948,13,18,30,31,38,41,5], [947,3,8,17,20,27,35,26], [946,9,18,19,30,34,40,20], [945,9,10,15,30,33,37,26], [944,2,13,16,19,32,33,42], [943,1,8,13,36,44,45,39], [942,10,12,18,35,42,43,39], [941,12,14,25,27,39,40,35], [940,3,15,20,22,24,41,11], [939,4,11,28,39,42,45,6], [938,4,8,10,16,31,36,9], [937,2,10,13,22,29,40,26], [936,7,11,13,17,18,29,43], [935,4,10,20,32,38,44,18], [934,1,3,30,33,36,39,12], [933,23,27,29,31,36,45,37], [932,1,6,15,36,37,38,5], [931,14,15,23,25,35,43,32], [930,8,21,25,38,39,44,28], [929,7,9,12,15,19,23,4], [928,3,4,10,20,28,44,30], [927,4,15,22,38,41,43,26], [926,10,16,18,20,25,31,6], [925,13,24,32,34,39,42,4], [924,3,11,34,42,43,44,13], [923,3,17,18,23,36,41,26], [922,2,6,13,17,27,43,36], [921,5,7,12,22,28,41,1], [920,2,3,26,33,34,43,29], [919,9,14,17,18,42,44,35], [918,7,11,12,31,33,38,5], [917,1,3,23,24,27,43,34], [916,6,21,22,32,35,36,17], [915,2,6,11,13,22,37,14], [914,16,19,24,33,42,44,27], [913,6,14,16,21,27,37,40], [912,5,8,18,21,22,38,10], [911,4,5,12,14,32,42,35], [910,1,11,17,27,35,39,31], [909,7,24,29,30,34,35,33], [908,3,16,21,22,23,44,30], [907,21,27,29,38,40,44,37], [906,2,5,14,28,31,32,20], [905,3,4,16,27,38,40,20], [904,2,6,8,26,43,45,11], [903,2,15,16,21,22,28,45], [902,7,19,23,24,36,39,30], [901,5,18,20,23,30,34,21], [900,7,13,16,18,35,38,14] ];

    // ===== ì „ì—­ ë³€ìˆ˜ =====
    let basket = []; // 10ìˆ˜
    let survivors = []; // ìƒì¡´ì ëª©ë¡
    let zeroFreqNums = [], machineFixed = [];
    let dynamicAvgSum = 145;
    let userName = "";
    let savedNumbers = [];
    let currentBaseRound = 1213;
    let generatedCombos = []; // ìƒì„±ëœ ì¡°í•© ëª©ë¡ (ì„ì‹œ ì €ì¥)
    let weightedScore = {}; // ê°€ì¤‘ì¹˜ ì ìˆ˜ (ì¡°í•© ìƒì„± ì‹œ ì‚¬ìš©)
    let middle = []; // B bag (ì‚¬ìš© ì•ˆ í•¨)
    let bonusNums = []; // ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ëª©ë¡
    let compressedOut4 = []; // 14ìˆ˜ì—ì„œ 10ìˆ˜ë¡œ ì¤„ë©´ì„œ ë¹ ì§„ 4ê°œ ë²ˆí˜¸

    // ===== ì‚¬ìš©ì ê´€ë¦¬ =====
    function updateUserDisplay() {
        const userDisplay = document.getElementById('userDisplay');
        userDisplay.innerHTML = `ğŸ‘¤ ${userName} 
            <button class="change-name-btn" onclick="changeName()">ì´ë¦„ë³€ê²½</button>
            <button class="change-name-btn" style="background:#ff4444;" onclick="deleteUser()">ì‚­ì œ</button>`;
    }
    function changeName() {
        const newName = prompt("ìƒˆë¡œìš´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", userName);
        if (newName && newName.trim() !== "") {
            userName = newName.trim();
            localStorage.setItem('lottoUserName', userName);
            const storageKey = `lottoSave_${userName}`;
            savedNumbers = JSON.parse(localStorage.getItem(storageKey)) || [];
            updateUserDisplay();
            showToast(`ì´ë¦„ì´ ${userName}(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤`);
        }
    }
    function deleteUser() {
        if(confirm(`ì •ë§ ${userName}ë‹˜ì˜ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            localStorage.removeItem(`lottoSave_${userName}`);
            userName = "guest_" + Math.random().toString(36).substring(2, 6);
            localStorage.setItem('lottoUserName', userName);
            savedNumbers = [];
            updateUserDisplay();
            showToast(`ìƒˆë¡œìš´ ì†ë‹˜ ê³„ì •(${userName})ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤`);
        }
    }
    function initUser() {
        const savedName = localStorage.getItem('lottoUserName');
        if (savedName) userName = savedName;
        else {
            userName = "guest_" + Math.random().toString(36).substring(2, 6);
            localStorage.setItem('lottoUserName', userName);
        }
        const storageKey = `lottoSave_${userName}`;
        savedNumbers = JSON.parse(localStorage.getItem(storageKey)) || [];
        updateUserDisplay();
    }

    // í† ìŠ¤íŠ¸ í‘œì‹œ í•¨ìˆ˜
    function showToast(message, duration = 1500) {
        const toast = document.getElementById('toast');
        const span = toast.querySelector('span');
        span.innerText = message;
        toast.style.display = 'block';
        setTimeout(() => {
            toast.style.display = 'none';
        }, duration);
    }

    // ì €ì¥ í•¨ìˆ˜ (í”¼ë“œë°± ì¶”ê°€)
    function saveToBox(s) {
        if (!savedNumbers.includes(s)) {
            savedNumbers.push(s);
            localStorage.setItem(`lottoSave_${userName}`, JSON.stringify(savedNumbers));
            showToast('âœ… ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
        } else {
            showToast('âš ï¸ ì´ë¯¸ ì €ì¥ëœ ì¡°í•©ì…ë‹ˆë‹¤');
        }
    }

    // ëª¨ë“  ì¡°í•© í•œ ë²ˆì— ì €ì¥
    function saveAllCombos() {
        if (generatedCombos.length === 0) {
            showToast('ì €ì¥í•  ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤');
            return;
        }
        let savedCount = 0;
        generatedCombos.forEach(combo => {
            if (!savedNumbers.includes(combo.key)) {
                savedNumbers.push(combo.key);
                savedCount++;
            }
        });
        if (savedCount > 0) {
            localStorage.setItem(`lottoSave_${userName}`, JSON.stringify(savedNumbers));
            showToast(`ğŸ“¦ ${savedCount}ê°œ ì¡°í•© ì €ì¥ë¨`);
        } else {
            showToast('ëª¨ë‘ ì´ë¯¸ ì €ì¥ëœ ì¡°í•©ì…ë‹ˆë‹¤');
        }
    }

    function deleteSingleItem(index) {
        if(confirm("ì´ ì¡°í•©ì„ ì‚­ì œí• ê¹Œìš”?")) {
            savedNumbers.splice(index, 1);
            localStorage.setItem(`lottoSave_${userName}`, JSON.stringify(savedNumbers));
            renderStorage();
            showToast('ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }
    }
    function loadFromStorage(nums) {
        alert(`ì„ íƒëœ ë²ˆí˜¸: ${nums.split(',').join(', ')}`);
        closePopup();
    }
    function renderStorage() {
        const st = document.getElementById('storage');
        if(savedNumbers.length === 0) { 
            st.innerHTML = "<div style='text-align:center; padding:12px; opacity:0.5;'>ì €ì¥ëœ ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤.</div>"; 
            return; 
        }
        st.innerHTML = savedNumbers.map((n, index) => {
            const numbers = n.split(',');
            return `
                <div class="row-line" style="margin-bottom:6px; background:#2a2a2a; padding:6px;">
                    <div class="num-container">
                        ${numbers.map(v=>`<span class="num-box" style="width:24px; height:24px; line-height:24px; font-size:10px;">${v}</span>`).join('')}
                    </div>
                    <div style="display:flex; gap:4px;">
                        <button onclick="loadFromStorage('${n}')" 
                                style="background:#00ccff; color:white; border:none; border-radius:4px; padding:3px 5px; font-size:9px; cursor:pointer;">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        <button onclick="deleteSingleItem(${index})" 
                                style="background:#ff4444; color:white; border:none; border-radius:4px; padding:3px 5px; font-size:9px; cursor:pointer;">ì‚­ì œ</button>
                    </div>
                </div>
            `;
        }).join('');
        document.querySelector('.popup-title').innerHTML = `ğŸ“¦ ${userName}ì˜ ë³´ê´€í•¨ (${savedNumbers.length}ê°œ)`;
    }

    // ===== 10ìˆ˜ ìƒì„± ì•Œê³ ë¦¬ì¦˜ (4íšŒì°¨ 51ì£¼ê°„ê²©, ìƒìœ„6+í•˜ìœ„4) =====
    function lottoSystem00001212Final(allData, lastWinning) {
        const targetRound = currentBaseRound;
        const targetRounds = [];
        for (let i = 1; i <= 4; i++) {
            targetRounds.push(targetRound - 51 * i);
        }
        const weights = [1.6, 1.5, 1.4, 1.3];

        let mainPool = [];
        let bonusPool = [];
        let mainWithRound = [];

        targetRounds.forEach((r, idx) => {
            const row = FULL_DATA.find(x => x[0] === r);
            if (row) {
                const mainNums = row.slice(1, 7);
                const bonusNum = row[7];
                mainNums.forEach(n => {
                    mainPool.push(n);
                    mainWithRound.push({ num: n, round: r, weight: weights[idx] });
                });
                bonusPool.push(bonusNum);
                // ë³´ë„ˆìŠ¤ ë²ˆí˜¸ëŠ” ê°€ì¤‘ì¹˜ ê³„ì‚°ì— í¬í•¨í•˜ì§€ ì•ŠìŒ
            }
        });

        let mainSet = new Set(mainPool);
        let mainNumbers = Array.from(mainSet);

        let wScore = {};
        mainWithRound.forEach(item => {
            wScore[item.num] = (wScore[item.num] || 0) + item.weight;
        });

        zeroFreqNums.forEach(num => {
            if (wScore[num] !== undefined) {
                wScore[num] += 0.2;
            }
        });

        let rankedMain = mainNumbers.sort((a, b) => {
            let aScore = wScore[a] || 0;
            let bScore = wScore[b] || 0;
            if (aScore > bScore) return -1;
            if (aScore < bScore) return 1;
            return a - b;
        });

        // 14ìˆ˜ (ìƒìœ„8 + í•˜ìœ„6) - ë¹ ì§„ 4ê°œ ê³„ì‚°ìš©
        let top8 = rankedMain.slice(0, 8);
        let bottom6 = rankedMain.slice(-6);
        let full14Set = new Set([...top8, ...bottom6]);
        let full14 = Array.from(full14Set).sort((a,b)=>a-b);

        // 10ìˆ˜ (ìƒìœ„6 + í•˜ìœ„4)
        let top6 = rankedMain.slice(0, 6);
        let bottom4 = rankedMain.slice(-4);
        let basketSet = new Set([...top6, ...bottom4]);
        let basket = Array.from(basketSet).sort((a, b) => a - b);

        // ì¤‘ê°„ ê·¸ë£¹ (ì‚¬ìš© ì•ˆ í•¨)
        let middleBag = rankedMain.filter(num => !basketSet.has(num));

        // ìƒì¡´ì (ë³¸ë²ˆí˜¸ + ë³´ë„ˆìŠ¤)
        let survivorsSet = new Set([...mainPool, ...bonusPool]);
        let survivors = Array.from(survivorsSet).sort((a,b)=>a-b);
        let bonusNumbers = Array.from(new Set(bonusPool)).sort((a, b) => a - b);

        // ë¹ ì§„ 4ê°œ ë²ˆí˜¸ (14ìˆ˜ - 10ìˆ˜)
        let compressedOut = full14.filter(num => !basketSet.has(num));

        return {
            survivors: survivors,
            basket: basket,
            middleBag: middleBag,
            bonusNumbers: bonusNumbers,
            weightedScore: wScore,
            compressedOut: compressedOut,
            full14: full14
        };
    }

    // ===== ë¶„ì„ í•¨ìˆ˜ =====
    function analyze() {
        const targetRound = currentBaseRound;
        const prevRound = targetRound - 1;
        
        const prevData = FULL_DATA.find(row => row[0] === prevRound);
        if (!prevData) {
            alert(`ê²½ê³ : ${prevRound}íšŒì°¨ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`);
            return;
        }
        const lastWinning = prevData.slice(1, 7);
        
        const targetRounds = [];
        for (let i = 1; i <= 4; i++) {
            targetRounds.push(targetRound - 51 * i);
        }
        
        let mainPool = [], bonusPool = [];
        targetRounds.forEach(r => {
            const row = FULL_DATA.find(x => x[0] === r);
            if (row) {
                mainPool.push(...row.slice(1, 7));
                bonusPool.push(row[7]);
            }
        });
        
        if (mainPool.length === 0) {
            alert('4íšŒì°¨ ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            return;
        }
        
        // ë¯¸ì¶œìˆ˜ ê³„ì‚° (ìµœê·¼ 22íšŒì°¨)
        let freq22 = {};
        for(let i=1; i<=45; i++) freq22[i] = 0;
        FULL_DATA.slice(0,22).forEach(row => {
            for(let j=1; j<=7; j++) if(row[j]) freq22[row[j]]++;
        });
        zeroFreqNums = Object.keys(freq22).filter(n => freq22[n]===0).map(Number).sort((a,b)=>a-b);
        
        const result = lottoSystem00001212Final(FULL_DATA, lastWinning);
        survivors = result.survivors;
        basket = result.basket; // 10ìˆ˜
        middle = result.middleBag || []; // ì‚¬ìš© ì•ˆ í•¨
        bonusNums = result.bonusNumbers || [];
        weightedScore = result.weightedScore || {};
        compressedOut4 = result.compressedOut || []; // ë¹ ì§„ 4ê°œ ë²ˆí˜¸
        machineFixed = basket.slice(0, 3);
        
        // í•©ê³„ ê³„ì‚° (ì°¸ê³ ìš©)
        let sums = [];
        targetRounds.forEach(r => {
            let row = FULL_DATA.find(x => x[0] === r);
            if (row) sums.push(row.slice(1,7).reduce((a,b)=>a+b,0));
        });
        if (sums.length > 0) dynamicAvgSum = Math.round(sums.reduce((a,b)=>a+b,0) / sums.length);
        else dynamicAvgSum = 145;
        
        const baseNums = prevData.slice(1, 7);
        const bonus = prevData[7];
        let ballHtml = baseNums.map(n => `<span class="base-num-box">${n}</span>`).join('');
        ballHtml += `<span class="bonus-label">ë³´ë„ˆìŠ¤</span>`;
        ballHtml += `<span class="base-num-box">${bonus}</span>`;
        document.getElementById('baseRoundInfo').innerHTML = ballHtml;
        document.getElementById('prevWinLabel').innerHTML = `ğŸ“Œ ${prevRound}íšŒ ë‹¹ì²¨ë²ˆí˜¸`;
        
        document.getElementById('roundDisplay').innerHTML = `ì˜ˆìƒ ${targetRound}íšŒì°¨`;
        document.getElementById('targetRound').innerText = targetRound;
        
        // ìƒíƒœì°½ í‘œì‹œ
        document.getElementById('status').innerHTML = `
            <div><span class="highlight-gold">â˜… 10ìˆ˜ ì—”ì§„ (4íšŒì°¨ 51ì£¼ê°„ê²©, ìƒìœ„6+í•˜ìœ„4)</span></div>
            <div>ìƒì¡´ì ${survivors.length}ìˆ˜: ${survivors.join(', ')}</div>
            <div>AI ì¶”ì²œ 10ìˆ˜: ${basket.join(', ')}</div>
            <div>ğŸ”» 14ìˆ˜ì—ì„œ ë¹ ì§„ 4ê°œ: ${compressedOut4.join(', ') || 'ì—†ìŒ'}</div>
            <div><span class="highlight-blue">ğŸ“Š ê¸°ì¤€ í•©ê³„ (4íšŒì°¨ í‰ê· ):</span> ${dynamicAvgSum} (ì°¸ê³ ìš©)</div>
            <div style="margin-top:4px; border-top:1px solid #333; padding-top:3px; font-size:9px; white-space:nowrap; overflow-x:auto; -webkit-overflow-scrolling:touch;">
                ğŸ“¦ B bag: ${middle.join(', ') || 'ì—†ìŒ'} | ğŸ¯ ë³´ë„ˆìŠ¤: ${bonusNums.join(', ') || 'ì—†ìŒ'}
            </div>
        `;
        
        document.getElementById('reviewTitle').innerHTML = `ğŸ“Š ${targetRound}íšŒ ë³µê¸°`;
        document.getElementById('reviewDesc').innerHTML = `${targetRound}íšŒ ë‹¹ì²¨ë²ˆí˜¸ 6ê°œ + ë³´ë„ˆìŠ¤ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”`;
        
        // ë³µê¸° íŒì—… ë‚´ AI ì •ë³´ ì´ˆê¸°í™”
        const reviewAIInfo = document.getElementById('reviewAIInfo');
        if (reviewAIInfo) {
            reviewAIInfo.innerHTML = `
                <div><span class="highlight-blue">ìƒì¡´ì ${survivors.length}ìˆ˜:</span> ${survivors.join(', ')}</div>
                <div><span class="highlight-gold">AI ì¶”ì²œ 10ìˆ˜:</span> ${basket.join(', ')}</div>
                <div><span class="highlight-blue">ğŸ“¦ B bag ${middle.length}ê°œ:</span> ${middle.join(', ') || 'ì—†ìŒ'}</div>
                <div><span class="highlight-blue">ğŸ¯ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ${bonusNums.length}ê°œ:</span> ${bonusNums.join(', ') || 'ì—†ìŒ'}</div>
                <div><span class="highlight-blue">ğŸ”» 14ìˆ˜ì—ì„œ ë¹ ì§„ 4ê°œ:</span> ${compressedOut4.join(', ') || 'ì—†ìŒ'}</div>
            `;
        }
    }

    function setBaseRound() {
        const input = document.getElementById('baseRoundInput').value;
        const round = parseInt(input);
        if (isNaN(round) || round < 901 || round > 1300) {
            alert('901~1300 ì‚¬ì´ì˜ íšŒì°¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }
        currentBaseRound = round;
        analyze();
    }

    // ===== ì¡°í•© ìƒì„± =====
    function process(limit) {
        analyze();
        generatedCombos = [];
        let used = new Set();
        
        if (limit === 10) {
            // 10ì¡°í•©: í™€ìˆ˜ ì¸ë±ìŠ¤(0,2,4,6,8) â†’ 14ìˆ˜ ì‚¬ìš©, ì§ìˆ˜ ì¸ë±ìŠ¤(1,3,5,7,9) â†’ 10ìˆ˜ ì‚¬ìš©
            let b10 = [...basket];
            let all14 = [...new Set([...b10, ...compressedOut4])].sort((a,b)=>a-b);
            
            for (let i = 0; i < limit; i++) {
                let combo = new Set();
                let pool = (i % 2 === 0) ? all14 : b10; // i=0,2,4,6,8 â†’ 14ìˆ˜, i=1,3,5,7,9 â†’ 10ìˆ˜
                
                let shuffled = [...pool].sort(() => Math.random() - 0.5);
                for (let n of shuffled) {
                    if (combo.size < 6) combo.add(n);
                }
                
                let finalArr = Array.from(combo).sort((a,b)=>a-b);
                let key = finalArr.join(',');
                
                if (!used.has(key)) {
                    used.add(key);
                    generatedCombos.push({
                        numbers: finalArr,
                        key: key,
                        mark: '',
                        comboNumber: i + 1
                    });
                } else {
                    limit++; // ì¤‘ë³µ ì‹œ ì¬ì‹œë„
                    if (limit > 100) break;
                }
            }
        } else {
            // 5ì¡°í•©: 10ìˆ˜ì—ì„œ ê°€ì¤‘ì¹˜ ê¸°ë°˜ ëœë¤ (compressedOut4 ì‚¬ìš© ì•ˆ í•¨)
            let count = 0, safety = 0;
            while (count < limit && safety < 50000) {
                safety++;
                let res = new Set();
                // ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì„ íƒ
                let weightedItems = basket.map(n => ({ num: n, weight: weightedScore[n] || 1 }));
                let weightedOrder = [];
                while (weightedItems.length > 0) {
                    let total = weightedItems.reduce((sum, item) => sum + item.weight, 0);
                    let rand = Math.random() * total;
                    let cum = 0;
                    for (let i = 0; i < weightedItems.length; i++) {
                        cum += weightedItems[i].weight;
                        if (rand < cum) {
                            weightedOrder.push(weightedItems[i].num);
                            weightedItems.splice(i, 1);
                            break;
                        }
                    }
                }
                for (let n of weightedOrder) {
                    if (res.size < 6) res.add(n);
                }
                // í˜¹ì‹œ ëª¨ìë¼ë©´ ëœë¤ ë³´ì¶© (ì´ë¡ ìƒ ì—†ìŒ)
                while (res.size < 6) {
                    let rand = basket[Math.floor(Math.random() * basket.length)];
                    res.add(rand);
                }
                let finalArr = Array.from(res).sort((a,b)=>a-b);
                let key = finalArr.join(',');
                if (!used.has(key)) {
                    used.add(key);
                    count++;
                    generatedCombos.push({
                        numbers: finalArr,
                        key: key,
                        mark: '',
                        comboNumber: count
                    });
                }
            }
        }
        
        showComboList();
    }

    function showComboList() {
        const content = document.getElementById('comboListContent');
        if (generatedCombos.length === 0) {
            content.innerHTML = '<div style="text-align:center; padding:12px;">ìƒì„±ëœ ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            document.getElementById('comboListPopup').style.display = 'flex';
            return;
        }
        let html = '';
        generatedCombos.forEach(combo => {
            // ê° ë²ˆí˜¸ê°€ íƒˆë½ìˆ˜(ìƒì¡´ìì´ì§€ë§Œ 10ìˆ˜ì— ì—†ìŒ)ì¸ì§€ í™•ì¸
            const numberSpans = combo.numbers.map(n => {
                const isEliminated = survivors.includes(n) && !basket.includes(n);
                const className = isEliminated ? 'num-box eliminated' : 'num-box';
                return `<span class="${className}" style="width:24px; height:24px; line-height:24px; font-size:10px;">${n}</span>`;
            }).join('');
            html += `<div class="combo-item-row">
                <div class="combo-nums">${numberSpans}</div>
                <div>
                    <button class="combo-save-btn" onclick="saveComboFromList('${combo.key}')">ì €ì¥</button>
                </div>
            </div>`;
        });
        content.innerHTML = html;
        document.getElementById('comboListPopup').style.display = 'flex';
    }

    function saveComboFromList(key) {
        saveToBox(key);
    }

    function closeComboListPopup() {
        document.getElementById('comboListPopup').style.display = 'none';
    }

    // ===== íŒì—… í•¨ìˆ˜ =====
    function openPopup() {
        document.getElementById('popup').style.display = 'flex';
        renderStorage();
    }
    function closePopup() {
        document.getElementById('popup').style.display = 'none';
    }

    // ===== ë³´ê´€í•¨ ì´ˆê¸°í™” (ìƒì„±ëœ ì¡°í•© ëª©ë¡ë„ í•¨ê»˜ ì´ˆê¸°í™”) =====
    function clearStorage() {
        if(confirm("ë³´ê´€í•¨ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")) {
            savedNumbers = [];
            generatedCombos = [];
            localStorage.removeItem(`lottoSave_${userName}`);
            renderStorage();
            showToast('ğŸ—‘ï¸ ë³´ê´€í•¨ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        }
    }

    // ===== ê²Œì„ ê´€ë ¨ í•¨ìˆ˜ (ê¸°ì¡´ê³¼ ë™ì¼) =====
    let touchGame = null;
    let touchInterval = null;
    let touchSelected = [];
    let reactionSelected = [];
    let reactionState = 'idle';
    let reactionTimer = null;
    let reactionStartTime = 0;

    function openGamePopup() {
        analyze();
        document.getElementById('gamePopup').style.display = 'flex';
        switchGame('touch');
    }
    function closeGamePopup() {
        document.getElementById('gamePopup').style.display = 'none';
        if (touchInterval) {
            cancelAnimationFrame(touchInterval);
            touchInterval = null;
        }
        clearTimeout(reactionTimer);
    }

    function switchGame(game) {
        document.querySelectorAll('.game-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.game-panel').forEach(panel => panel.classList.remove('active'));
        if (game === 'touch') {
            document.querySelector('[data-game="touch"]').classList.add('active');
            document.getElementById('touchGame').classList.add('active');
            startTouchGame();
        } else {
            document.querySelector('[data-game="reaction"]').classList.add('active');
            document.getElementById('reactionGame').classList.add('active');
            const box = document.getElementById('reactionBox');
            if (box) {
                box.style.background = '#222';
                box.innerText = 'ì‹œì‘í•˜ë ¤ë©´ ëˆ„ë¥´ì„¸ìš”';
            }
            document.getElementById('reactionResult').innerText = '';
            reactionSelected = [];
            updateReactionSelectedDisplay();
            reactionState = 'idle';
            clearTimeout(reactionTimer);
        }
    }

    function startTouchGame() {
        const canvas = document.getElementById('gameCanvas');
        if (!canvas) return;
        canvas.width = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
        touchGame = {
            ctx: canvas.getContext('2d'),
            width: canvas.width,
            height: canvas.height,
            numbers: [],
            highlightSet: new Set(basket)
        };
        for (let i = 1; i <= 45; i++) {
            touchGame.numbers.push({
                num: i,
                x: Math.random() * (canvas.width - 40) + 20,
                y: Math.random() * (canvas.height - 40) + 20,
                vx: (Math.random() - 0.5) * 3,
                vy: (Math.random() - 0.5) * 3,
                radius: 18
            });
        }
        touchSelected = [];
        updateTouchDisplay();
        if (touchInterval) cancelAnimationFrame(touchInterval);
        touchInterval = requestAnimationFrame(updateTouchGame);
    }
    function updateTouchGame() {
        if (!touchGame) return;
        const ctx = touchGame.ctx;
        const w = touchGame.width;
        const h = touchGame.height;
        ctx.clearRect(0, 0, w, h);
        touchGame.numbers.forEach(num => {
            num.x += num.vx;
            num.y += num.vy;
            if (num.x - num.radius < 0 || num.x + num.radius > w) {
                num.vx *= -1;
                num.x = Math.max(num.radius, Math.min(w - num.radius, num.x));
            }
            if (num.y - num.radius < 0 || num.y + num.radius > h) {
                num.vy *= -1;
                num.y = Math.max(num.radius, Math.min(h - num.radius, num.y));
            }
            ctx.beginPath();
            ctx.arc(num.x, num.y, num.radius, 0, 2 * Math.PI);
            if (touchGame.highlightSet.has(num.num)) {
                ctx.strokeStyle = '#ffd700';
                ctx.lineWidth = 3;
                ctx.fillStyle = '#000000';
            } else {
                ctx.strokeStyle = '#888';
                ctx.lineWidth = 2;
                ctx.fillStyle = '#000000';
            }
            ctx.fill();
            ctx.stroke();
            ctx.fillStyle = '#ffd700';
            ctx.font = 'bold 12px Malgun Gothic';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(num.num, num.x, num.y);
        });
        touchInterval = requestAnimationFrame(updateTouchGame);
    }
    document.addEventListener('touchstart', (e) => {
        if (!touchGame || document.getElementById('gamePopup').style.display !== 'flex' || !document.getElementById('touchGame').classList.contains('active')) return;
        const canvas = document.getElementById('gameCanvas');
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches[0];
        const x = (touch.clientX - rect.left) * (canvas.width / rect.width);
        const y = (touch.clientY - rect.top) * (canvas.height / rect.height);
        let touchedNum = null;
        let minDist = Infinity;
        touchGame.numbers.forEach(num => {
            const dx = num.x - x;
            const dy = num.y - y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            if (dist < num.radius && dist < minDist) {
                minDist = dist;
                touchedNum = num.num;
            }
        });
        if (touchedNum !== null && !touchSelected.includes(touchedNum)) {
            touchSelected.push(touchedNum);
            updateTouchDisplay();
        }
        e.preventDefault();
    }, { passive: false });
    function updateTouchDisplay() {
        const container = document.getElementById('selectedNumbersContainer');
        const html = touchSelected.map(n => `<div class="selected-ball">${n}</div>`).join('');
        container.innerHTML = html || '<div style="color:#666;">í„°ì¹˜í•´ì„œ ìˆ«ìë¥¼ ì„ íƒí•˜ì„¸ìš”</div>';
        document.getElementById('saveComboBtn').disabled = touchSelected.length !== 6;
    }
    function resetTouchGame() {
        if (touchGame) {
            touchGame.numbers.forEach(num => {
                num.x = Math.random() * (touchGame.width - 40) + 20;
                num.y = Math.random() * (touchGame.height - 40) + 20;
                num.vx = (Math.random() - 0.5) * 3;
                num.vy = (Math.random() - 0.5) * 3;
            });
            touchSelected = [];
            updateTouchDisplay();
        }
    }
    function saveTouchCombo() {
        if (touchSelected.length === 6) {
            const sorted = [...touchSelected].sort((a,b)=>a-b);
            saveToBox(sorted.join(','));
            touchSelected = [];
            updateTouchDisplay();
        }
    }

    function updateReactionSelectedDisplay() {
        const container = document.getElementById('reactionSelectedContainer');
        const html = reactionSelected.map(n => `<div class="selected-ball">${n}</div>`).join('');
        container.innerHTML = html || '<div style="color:#666;">í„°ì¹˜í•´ì„œ ë²ˆí˜¸ë¥¼ ë½‘ìœ¼ì„¸ìš”</div>';
        document.getElementById('saveReactionBtn').disabled = reactionSelected.length !== 6;
    }

    function startReaction() {
        const box = document.getElementById('reactionBox');
        if (!box) return;
        reactionState = 'waiting';
        box.style.background = '#222';
        box.innerText = 'ê¸°ë‹¤ë¦¬ì„¸ìš”...';
        document.getElementById('reactionResult').innerText = '';
        const delay = Math.random() * 2000 + 1000;
        clearTimeout(reactionTimer);
        reactionTimer = setTimeout(() => {
            if (reactionState === 'waiting') {
                reactionState = 'ready';
                box.style.background = '#00aa00';
                box.innerText = 'í„°ì¹˜!';
                reactionStartTime = performance.now();
            }
        }, delay);
    }

    function handleReactionClick() {
        const box = document.getElementById('reactionBox');
        const result = document.getElementById('reactionResult');
        if (!box || !result) return;
        
        if (reactionState === 'ready') {
            const reactionTime = performance.now() - reactionStartTime;
            const randomNum = Math.floor(Math.random() * 45) + 1;
            result.innerText = `ë°˜ì‘ì†ë„: ${reactionTime.toFixed(0)}ms`;
            
            if (!reactionSelected.includes(randomNum)) {
                reactionSelected.push(randomNum);
                updateReactionSelectedDisplay();
            }
            
            box.style.background = '#222';
            box.innerText = 'ë‹¤ì‹œ í•˜ë ¤ë©´ ìƒˆ ê²Œì„ ë²„íŠ¼';
            reactionState = 'idle';
            clearTimeout(reactionTimer);
        } else if (reactionState === 'waiting') {
            result.innerText = 'ë„ˆë¬´ ë¹¨ëì–´ìš”! ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.';
            box.style.background = '#222';
            box.innerText = 'ì‹œì‘ ë²„íŠ¼ ëˆ„ë¥´ê¸°';
            reactionState = 'idle';
            clearTimeout(reactionTimer);
        }
    }

    function resetReactionGame() {
        reactionSelected = [];
        updateReactionSelectedDisplay();
        startReaction();
    }

    function saveReactionCombo() {
        if (reactionSelected.length === 6) {
            const sorted = [...reactionSelected].sort((a,b)=>a-b);
            saveToBox(sorted.join(','));
            reactionSelected = [];
            updateReactionSelectedDisplay();
            startReaction();
        }
    }

    // ===== ë³µê¸° í•¨ìˆ˜ =====
    function openReviewPopup() {
        analyze();
        const targetRound = currentBaseRound;
        const winData = FULL_DATA.find(row => row[0] === targetRound);
        const winningDisplay = document.getElementById('winningDisplay');
        if (winData) {
            const nums = winData.slice(1, 7).join(', ');
            const bonus = winData[7];
            winningDisplay.innerHTML = `ğŸ“Œ ${targetRound}íšŒ ë‹¹ì²¨ë²ˆí˜¸: ${nums} + ë³´ë„ˆìŠ¤ ${bonus}`;
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`win${i}`).value = winData[i];
            }
            document.getElementById('bonus').value = winData[7];
        } else {
            winningDisplay.innerHTML = `ğŸ“Œ ${targetRound}íšŒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`;
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`win${i}`).value = '';
            }
            document.getElementById('bonus').value = '';
        }
        document.getElementById('reviewPopup').style.display = 'flex';
    }

    function closeReviewPopup() {
        document.getElementById('reviewPopup').style.display = 'none';
    }

    function compareNumbers() {
        const win = [
            parseInt(document.getElementById('win1').value),
            parseInt(document.getElementById('win2').value),
            parseInt(document.getElementById('win3').value),
            parseInt(document.getElementById('win4').value),
            parseInt(document.getElementById('win5').value),
            parseInt(document.getElementById('win6').value)
        ];
        const bonus = parseInt(document.getElementById('bonus').value);

        if (win.some(isNaN) || isNaN(bonus)) {
            alert('ëª¨ë“  ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        if (new Set(win).size !== 6) {
            alert('ë‹¹ì²¨ë²ˆí˜¸ëŠ” ì¤‘ë³µ ì—†ì´ 6ê°œë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
            return;
        }

        const winSet = new Set(win);
        const aiMatched = basket.filter(n => winSet.has(n));
        const aiMatchCount = aiMatched.length;
        const aiBonusMatch = basket.includes(bonus);
        document.getElementById('aiMatch').innerText = `${aiMatchCount}ê°œ ì¼ì¹˜`;
        document.getElementById('aiMatchedList').innerHTML = aiMatched.length ? `ì¼ì¹˜ ë²ˆí˜¸: ${aiMatched.join(', ')}` : '';
        document.getElementById('aiBonus').innerHTML = aiBonusMatch ? '(ë³´ë„ˆìŠ¤ ë²ˆí˜¸ í¬í•¨)' : '';

        const savedDiv = document.getElementById('savedMatch');
        if (savedNumbers.length === 0) {
            savedDiv.innerHTML = 'ì €ì¥ëœ ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤.';
        } else {
            let html = '';
            savedNumbers.forEach(combo => {
                const nums = combo.split(',').map(Number);
                const matchCount = nums.filter(n => winSet.has(n)).length;
                const hasBonus = nums.includes(bonus);
                let rankInfo = '';
                if (matchCount === 6) rankInfo = 'ğŸ¥‡ 1ë“±';
                else if (matchCount === 5 && hasBonus) rankInfo = 'ğŸ¥ˆ 2ë“±';
                else if (matchCount === 5) rankInfo = 'ğŸ¥‰ 3ë“±';
                else if (matchCount === 4) rankInfo = '4ë“±';
                else if (matchCount === 3) rankInfo = '5ë“±';
                else rankInfo = 'ë‚™ì²¨';
                html += `<div class="combo-item"><span>${combo}</span><span>${matchCount}ê°œ ${rankInfo}</span></div>`;
            });
            savedDiv.innerHTML = html;
        }

        const reviewAIInfo = document.getElementById('reviewAIInfo');
        if (reviewAIInfo) {
            const survivorsHtml = survivors.map(n => winSet.has(n) ? `<span class="matched">${n}</span>` : n).join(', ');
            const basketHtml = basket.map(n => winSet.has(n) ? `<span class="matched">${n}</span>` : n).join(', ');
            const middleHtml = middle.map(n => winSet.has(n) ? `<span class="matched">${n}</span>` : n).join(', ') || 'ì—†ìŒ';
            const bonusNumsHtml = bonusNums.map(n => n === bonus ? `<span class="matched">${n}</span>` : n).join(', ') || 'ì—†ìŒ';
            const outHtml = compressedOut4.map(n => winSet.has(n) ? `<span class="matched">${n}</span>` : n).join(', ') || 'ì—†ìŒ';

            reviewAIInfo.innerHTML = `
                <div><span class="highlight-blue">ìƒì¡´ì ${survivors.length}ìˆ˜:</span> ${survivorsHtml}</div>
                <div><span class="highlight-gold">AI ì¶”ì²œ 10ìˆ˜:</span> ${basketHtml}</div>
                <div><span class="highlight-blue">ğŸ“¦ B bag ${middle.length}ê°œ:</span> ${middleHtml}</div>
                <div><span class="highlight-blue">ğŸ¯ ë³´ë„ˆìŠ¤ ë²ˆí˜¸ ${bonusNums.length}ê°œ:</span> ${bonusNumsHtml}</div>
                <div><span class="highlight-blue">ğŸ”» 14ìˆ˜ì—ì„œ ë¹ ì§„ 4ê°œ:</span> ${outHtml}</div>
            `;
        }
    }

    function showComboDetail(arr, comboNumber) {
        document.getElementById('comboDetailTitle').innerText = `${comboNumber}ì¡°í•© ìƒì„¸ (${arr.join(', ')})`;
        const content = document.getElementById('comboDetailContent');
        const sections = [
            { name: '1-10', range: [1,10] },
            { name: '11-20', range: [11,20] },
            { name: '21-30', range: [21,30] },
            { name: '31-40', range: [31,40] },
            { name: '41-45', range: [41,45] }
        ];
        let html = '';
        sections.forEach(sec => {
            const numsInSection = arr.filter(n => n >= sec.range[0] && n <= sec.range[1]);
            html += `<div class="section-row">
                <span class="section-label">${sec.name}</span>
                <div class="section-nums">
                    ${numsInSection.length ? numsInSection.map(n => `<span class="num-box" style="width:24px; height:24px; line-height:24px; font-size:10px;">${n}</span>`).join('') : 'ì—†ìŒ'}
                </div>
            </div>`;
        });
        content.innerHTML = html;
        document.getElementById('comboDetailPopup').style.display = 'flex';
    }

    function closeComboDetailPopup() {
        document.getElementById('comboDetailPopup').style.display = 'none';
    }

    window.onload = function() {
        initUser();
        setBaseRound();
    };
</script>
</body>
</html>
