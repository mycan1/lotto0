<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SHIN-UI-SON v24.1 - 1212íšŒì°¨ ì§‘ì¤‘ ë¶„ì„í˜• (1ë²ˆì½”ë“œ ì ìš©)</title>
    <style>
        :root { --gold: #ffd700; --bg: #0b0b0b; --card: #1a1a1a; --accent: #00ffcc; --save: #ff00ff; --danger: #ff4444; }
        body { background-color: var(--bg); color: var(--gold); font-family: 'Malgun Gothic', sans-serif; padding: 10px; margin: 0; }
        .outer-border { border: 2px solid var(--gold); border-radius: 20px; padding: 15px; max-width: 480px; margin: 0 auto; }
        .header-box { text-align: center; margin-bottom: 10px; }
        
        .next-episode { 
            font-size: 22px; 
            font-weight: 900; 
            color: #fff; 
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }
        
        .round-text {
            font-size: 32px;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 0 0 15px #ffd700;
            margin: 0 0 5px 0;
        }
        
        .status-info { 
            font-size: 11px; 
            color: var(--accent); 
            line-height: 1.5; 
            min-height: 80px;
            width: 100%; 
            background: rgba(255,255,255,0.05); 
            border-radius: 12px; 
            padding: 10px; 
            box-sizing: border-box; 
            margin-top: 8px; 
            text-align: left; 
            border: 1px solid #333; 
        }
        
        .highlight-gold { color: var(--gold); font-weight: bold; }
        .highlight-red { color: var(--danger); font-weight: bold; }
        .highlight-blue { color: #00ccff; font-weight: bold; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 15px 0; }
        button { border-radius: 10px; font-weight: bold; cursor: pointer; border: none; height: 50px; transition: 0.2s; }
        .btn-5set { background: linear-gradient(135deg, #00ffcc, #00a884); color: #000; font-size: 16px; }
        .btn-main { background: linear-gradient(135deg, #ffd700, #b8860b); color: #000; font-size: 16px; }
        .btn-sub { background: #222; color: #fff; border: 1px solid #444; }
        .btn-reset { grid-column: span 2; background: #333; color: #aaa; height: 40px; margin-top: 5px; }
        
        .row-line { background: var(--card); border-radius: 12px; padding: 12px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #333; }
        .num-container { display: flex; gap: 5px; flex-grow: 1; justify-content: center; }
        .num-box { width: 34px; height: 34px; line-height: 34px; text-align: center; font-size: 14px; font-weight: 900; border-radius: 50%; color: #fff; }
        .fixed { background: linear-gradient(135deg, #00ffcc, #00a884); color: #000; } 
        .zero { background: linear-gradient(135deg, #ff4444, #b30000); } 
        .normal { background: #444; border: 1px solid var(--gold); }
        .save-btn { font-size: 11px; background: var(--save); color: white; padding: 6px 10px; border-radius: 6px; cursor: pointer; }
        .badge { font-size: 10px; background: #333; padding: 2px 6px; border-radius: 10px; margin-left: 5px; color: #aaa; }
        
        .popup-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .popup-content {
            background: var(--card);
            border: 2px solid var(--gold);
            border-radius: 20px;
            padding: 20px;
            max-width: 400px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            position: relative;
        }
        .popup-close {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: var(--gold);
        }
        .popup-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            color: var(--gold);
        }
        .user-info {
            background: #333;
            color: var(--accent);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-bottom: 10px;
            text-align: center;
        }
        .change-name-btn {
            background: #00ccff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 3px 8px;
            font-size: 10px;
            margin-left: 5px;
            cursor: pointer;
        }
        
        .small-note {
            margin-top: 3px;
            color: #888;
            font-size: 9px;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="outer-border">
    <div class="header-box">
        <div class="next-episode">SHIN-UI-SON v24.1 + 1ë²ˆì½”ë“œ</div>
        <div class="round-text">ì˜ˆìƒ 1212íšŒì°¨</div>
        <div id="userDisplay" class="user-info"></div>
        <div id="status" class="status-info">ì—”ì§„ ì´ˆê¸°í™” ì¤‘...</div>
    </div>

    <div class="btn-group">
        <button class="btn-5set" onclick="process(5)">5ì¡°í•© ì¶”ì¶œ</button>
        <button class="btn-main" onclick="process(10)">10ì¡°í•© ì¶”ì¶œ</button>
        <button class="btn-sub" onclick="openPopup()">ë³´ê´€í•¨</button>
        <button class="btn-sub" onclick="clearStorage()">ì´ˆê¸°í™”</button>
        <button class="btn-sub btn-reset" onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div id="console"></div>
    <div class="small-note">â€» 9,10ë²ˆ ì¡°í•©ì— ë¯¸ì¶œìˆ˜ í¬í•¨ (ìµœëŒ€ 4ê°œ) | ğŸ¯ 1212íšŒì°¨ ì˜ˆìƒ</div>
</div>

<div id="popup" class="popup-overlay" style="display:none;">
    <div class="popup-content">
        <span class="popup-close" onclick="closePopup()">&times;</span>
        <div class="popup-title">ğŸ“¦ ë³´ê´€í•¨</div>
        <div id="storage"></div>
    </div>
</div>

<script>
    const FULL_DATA = [[1211,23,26,27,35,38,40,10],[1210,1,7,9,17,27,38,31],[1209,2,17,20,35,37,39,24],[1208,6,27,30,36,38,42,25],[1207,10,22,24,27,38,45,11],[1206,1,3,17,26,27,42,23],[1205,1,4,16,23,31,41,2],[1204,8,16,28,30,31,44,27],[1203,3,6,18,29,35,39,24],[1202,5,12,21,33,37,40,7],[1201,7,9,24,27,35,36,37],[1200,1,2,4,16,20,32,45],[1199,16,24,25,30,31,32,7],[1198,26,30,33,38,39,41,21],[1197,1,5,7,26,28,43,30],[1196,8,12,15,29,40,45,14],[1195,3,15,27,33,34,36,37],[1194,3,13,15,24,33,37,2],[1193,6,9,16,19,24,28,17],[1192,10,16,23,36,39,40,11],[1191,1,4,11,12,20,41,2],[1190,7,9,19,23,26,45,33],[1189,9,19,29,35,37,38,31],[1188,3,4,12,19,22,27,9],[1187,5,13,26,29,37,40,42],[1186,2,8,13,16,23,28,35],[1185,6,17,22,28,29,32,38],[1184,14,16,23,25,31,37,42],[1183,4,15,17,23,27,36,31],[1182,1,13,21,25,28,31,22],[1181,8,10,14,20,33,41,28],[1180,6,12,18,37,40,41,3],[1179,3,16,18,24,40,44,21],[1178,5,6,11,27,43,44,17],[1177,3,7,15,16,19,43,21],[1176,7,9,11,21,30,35,29],[1175,3,4,6,8,32,42,31],[1174,8,11,14,17,36,39,22],[1173,1,5,18,20,30,35,3],[1172,7,9,24,40,42,44,45],[1171,3,6,7,11,12,17,19],[1170,3,13,28,34,38,42,25],[1169,5,12,24,26,39,42,20],[1168,9,21,24,30,33,37,29],[1167,8,23,31,35,39,40,24],[1166,14,23,25,27,29,42,16],[1165,6,7,27,29,38,45,17],[1164,17,18,23,25,38,39,22],[1163,2,13,15,16,33,43,4],[1162,20,21,22,25,28,29,6],[1161,2,12,20,24,34,42,37],[1160,7,13,18,36,39,45,19],[1159,3,9,27,28,38,39,7],[1158,21,25,27,32,37,38,20],[1157,5,7,12,20,25,26,28],[1156,30,31,34,39,41,45,7],[1155,10,16,19,27,37,38,13],[1154,4,8,22,26,32,38,27],[1153,1,9,10,13,35,44,5],[1152,30,31,32,35,36,37,5],[1151,2,3,9,15,27,29,8],[1150,8,9,18,35,39,45,25],[1149,8,15,19,21,32,36,38],[1148,3,6,13,15,16,22,32],[1147,7,11,24,26,27,37,32],[1146,6,11,17,19,40,43,28],[1145,2,11,31,33,37,44,32],[1144,3,4,12,15,26,34,6],[1143,10,16,17,27,28,36,6],[1142,2,8,28,30,37,41,22],[1141,7,11,12,21,26,35,20],[1140,7,10,22,29,31,38,15],[1139,5,12,15,30,37,40,18],[1138,14,16,19,20,29,34,35],[1137,4,9,12,15,33,45,26],[1136,21,33,35,38,42,44,1],[1135,1,6,13,19,21,33,4],[1134,3,7,9,13,19,24,23],[1133,13,14,20,28,29,34,23],[1132,6,7,19,28,34,41,5],[1131,1,2,6,14,27,38,33],[1130,15,19,21,25,27,28,40],[1129,5,10,11,17,28,34,22],[1128,1,5,8,16,28,33,45],[1127,10,15,24,30,31,37,32],[1126,4,5,9,11,37,40,7],[1125,6,14,25,33,40,44,30],[1124,3,8,17,30,33,34,28],[1123,13,19,21,24,34,35,26],[1122,3,6,21,30,34,35,22],[1121,6,24,31,32,38,44,8],[1120,2,19,26,31,38,41,34],[1119,1,9,12,13,20,45,3],[1118,11,13,14,15,16,45,3],[1117,3,4,9,30,33,36,7],[1116,15,16,17,25,30,31,32],[1115,7,12,23,32,34,36,8],[1114,10,16,19,32,33,38,3],[1113,11,13,20,21,32,44,8],[1112,16,20,26,36,42,44,24]];

    let basket = [], zeroFreqNums = [], machineFixed = [];
    let dynamicAvgSum = 145;
    
    // ===== ì´ë¦„ ê´€ë¦¬ ê¸°ëŠ¥ =====
    let userName = "";
    let savedNumbers = [];
    
    function updateUserDisplay() {
        const userDisplay = document.getElementById('userDisplay');
        userDisplay.innerHTML = `ğŸ‘¤ í˜„ì¬ ì ‘ì†ì: ${userName} 
            <button class="change-name-btn" onclick="changeName()">ì´ë¦„ë³€ê²½</button>
            <button class="change-name-btn" style="background:#ff4444;" onclick="deleteUser()">ì‚­ì œ</button>`;
    }
    
    function changeName() {
        const newName = prompt("ìƒˆë¡œìš´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", userName);
        if (newName && newName.trim() !== "") {
            userName = newName.trim();
            localStorage.setItem('lottoUserName', userName);
            
            const storageKey = `lottoSave_${userName}`;
            const localData = localStorage.getItem(storageKey);
            savedNumbers = localData ? JSON.parse(localData) : [];
            
            updateUserDisplay();
            analyze();
            alert(`ì´ë¦„ì´ ${userName}(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
    }
    
    function deleteUser() {
        if(confirm(`ì •ë§ ${userName}ë‹˜ì˜ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            const storageKey = `lottoSave_${userName}`;
            localStorage.removeItem(storageKey);
            
            userName = "guest_" + Math.random().toString(36).substring(2, 6);
            localStorage.setItem('lottoUserName', userName);
            savedNumbers = [];
            
            updateUserDisplay();
            analyze();
            alert(`ìƒˆë¡œìš´ ì†ë‹˜ ê³„ì •(${userName})ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.`);
        }
    }

    function initUser() {
        const savedName = localStorage.getItem('lottoUserName');
        
        if (savedName) {
            userName = savedName;
        } else {
            userName = "guest_" + Math.random().toString(36).substring(2, 6);
            localStorage.setItem('lottoUserName', userName);
        }
        
        const storageKey = `lottoSave_${userName}`;
        const localData = localStorage.getItem(storageKey);
        savedNumbers = localData ? JSON.parse(localData) : [];
        
        updateUserDisplay();
        document.getElementById('status').innerHTML = `ë¶„ì„ ì´ˆê¸°í™” ì¤‘...`;
    }

    function saveToBox(s) {
        if(!savedNumbers.includes(s)) {
            savedNumbers.push(s);
            const storageKey = `lottoSave_${userName}`;
            localStorage.setItem(storageKey, JSON.stringify(savedNumbers));
            alert(`${userName}ë‹˜ì˜ ë³´ê´€í•¨ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        } else {
            alert("ì´ë¯¸ ì €ì¥ëœ ë²ˆí˜¸ì…ë‹ˆë‹¤.");
        }
    }

    function deleteSingleItem(index) {
        if(confirm("ì´ ì¡°í•©ì„ ì‚­ì œí• ê¹Œìš”?")) {
            savedNumbers.splice(index, 1);
            const storageKey = `lottoSave_${userName}`;
            localStorage.setItem(storageKey, JSON.stringify(savedNumbers));
            renderStorage();
        }
    }

    function loadFromStorage(nums) {
        alert(`ì„ íƒëœ ë²ˆí˜¸: ${nums.split(',').join(', ')}`);
        closePopup();
    }

    function renderStorage() {
        const st = document.getElementById('storage');
        if(savedNumbers.length === 0) { 
            st.innerHTML = "<div style='text-align:center; padding:20px; opacity:0.5;'>ì €ì¥ëœ ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤.</div>"; 
            return; 
        }
        
        st.innerHTML = savedNumbers.map((n, index) => {
            const numbers = n.split(',');
            return `
                <div class="row-line" style="margin-bottom:10px; background:#2a2a2a;">
                    <div class="num-container">
                        ${numbers.map(v=>`<span class="num-box normal" style="background:#444; font-size:12px;">${v}</span>`).join('')}
                    </div>
                    <div style="display:flex; gap:5px;">
                        <button onclick="loadFromStorage('${n}')" 
                                style="background:#00ccff; color:white; border:none; border-radius:5px; padding:5px 8px; font-size:11px; cursor:pointer;">ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        <button onclick="deleteSingleItem(${index})" 
                                style="background:#ff4444; color:white; border:none; border-radius:5px; padding:5px 8px; font-size:11px; cursor:pointer;">ì‚­ì œ</button>
                    </div>
                </div>
            `;
        }).join('');
        
        document.querySelector('.popup-title').innerHTML = `ğŸ“¦ ${userName}ì˜ ë³´ê´€í•¨ (${savedNumbers.length}ê°œ)`;
    }

    // ===== 1ë²ˆì½”ë“œ: lotto_system_0000_1212_Final (JavaScript ë³€í™˜) =====
    function lottoSystem00001212Final(allData, targetRound, lastWinning) {
        // ë°ì´í„° ë§µ êµ¬ì„±
        let dataMap = {};
        allData.forEach(row => {
            if (!isNaN(parseInt(row[0]))) {
                dataMap[parseInt(row[0])] = row.map(x => parseInt(x));
            }
        });

        // 52ì£¼ ê°„ê²© 5íšŒì°¨ ì¶”ì¶œ
        let cycleRounds = [];
        for (let i = 1; i <= 5; i++) {
            cycleRounds.push(targetRound - 52 * i);
        }

        let mainPool = [];
        let bonusPool = [];
        cycleRounds.forEach(r => {
            if (dataMap[r]) {
                // main numbers: indices 1~6 (ì²« ë²ˆì§¸ ë²ˆí˜¸ë¶€í„° ì—¬ì„¯ ë²ˆì§¸ ë²ˆí˜¸)
                // bonus: index 7
                // â€» Python ì½”ë“œëŠ” [2:8]ì´ì—ˆìœ¼ë‚˜, HTML ë°ì´í„° êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì • (1:7ì´ ì •ìƒ)
                let mainNums = dataMap[r].slice(1, 7);  // 6ê°œ ë³¸ë²ˆí˜¸
                let bonusNum = dataMap[r][7];          // ë³´ë„ˆìŠ¤ ë²ˆí˜¸
                mainPool.push(...mainNums);
                bonusPool.push(bonusNum);
            }
        });

        // ìƒì¡´ì(25ìˆ˜ ë‚´ì™¸)
        let survivorsSet = new Set([...mainPool, ...bonusPool]);
        let survivors = Array.from(survivorsSet);

        // ë¹ˆë„ ê³„ì‚°
        let mainFreq = {};
        mainPool.forEach(n => mainFreq[n] = (mainFreq[n] || 0) + 1);
        let bonusFreq = {};
        bonusPool.forEach(n => bonusFreq[n] = (bonusFreq[n] || 0) + 1);

        // ìƒì¡´ì ì •ë ¬: ì´ì›”ìˆ˜ ìµœìš°ì„ , ë³¸ë¹ˆë„ ë†’ì€ ìˆœ, ë‚®ì€ ë²ˆí˜¸ ìˆœ
        let rankedAll = survivors.sort((a, b) => {
            let aInLast = lastWinning.includes(a);
            let bInLast = lastWinning.includes(b);
            if (aInLast && !bInLast) return -1;
            if (!aInLast && bInLast) return 1;
            let aFreq = mainFreq[a] || 0;
            let bFreq = mainFreq[b] || 0;
            if (aFreq > bFreq) return -1;
            if (aFreq < bFreq) return 1;
            return a - b; // ë‚®ì€ ë²ˆí˜¸ ìš°ì„ 
        });

        // ì² ë°¥í†µ 13ìˆ˜
        let final17 = rankedAll.slice(0, 13);
        let remaining = rankedAll.slice(13);

        // ë°˜ë€êµ° 4ìˆ˜ (ë³´ë„ˆìŠ¤ ë¹ˆë„ ë†’ì€ ìˆœ, ë‚®ì€ ë²ˆí˜¸ ìˆœ)
        let rebels = remaining.sort((a, b) => {
            let aFreq = bonusFreq[a] || 0;
            let bFreq = bonusFreq[b] || 0;
            if (aFreq > bFreq) return -1;
            if (aFreq < bFreq) return 1;
            return a - b;
        }).slice(0, 4);

        final17.push(...rebels);

        // êµ¬ê°„ êµ¬ë© ë©”ìš°ê¸° (1~10, 11~20, 21~30, 31~40, 41~45)
        let sections = [
            [1, 10], [11, 20], [21, 30], [31, 40], [41, 45]
        ];
        sections.forEach(([start, end]) => {
            let hasNum = final17.some(n => n >= start && n <= end);
            if (!hasNum) {
                let candidates = survivors.filter(n => n >= start && n <= end && !final17.includes(n));
                if (candidates.length > 0) {
                    candidates.sort((a, b) => {
                        let aFreq = bonusFreq[a] || 0;
                        let bFreq = bonusFreq[b] || 0;
                        if (aFreq > bFreq) return -1;
                        if (aFreq < bFreq) return 1;
                        return a - b;
                    });
                    let joker = candidates[0];
                    final17.pop(); // ë§ˆì§€ë§‰ ë²ˆí˜¸ ì œê±°
                    final17.push(joker);
                }
            }
        });

        // ì¤‘ë³µ ì œê±° ë° ì •ë ¬ í›„ ë°˜í™˜
        return Array.from(new Set(final17)).sort((a, b) => a - b);
    }

    // ===== í†µí•© ë¶„ì„ í•¨ìˆ˜ (1ë²ˆì½”ë“œ ê¸°ë°˜) =====
    function analyze() {
        // ë¯¸ì¶œìˆ˜ ë¶„ì„ (ìµœê·¼ 22íšŒ) - ê¸°ì¡´ UI í‘œì‹œìš©
        const zeroRange = 22;
        const data22 = FULL_DATA.slice(0, zeroRange);
        let freq22 = {};
        for(let i=1; i<=45; i++) freq22[i] = 0;
        data22.forEach(row => { for(let j=1; j<=7; j++) { if(row[j]) freq22[row[j]]++; } });
        zeroFreqNums = Object.keys(freq22).filter(n => freq22[n] === 0).map(Number).sort((a,b)=>a-b);

        // 1ë²ˆì½”ë“œ ì‹¤í–‰: 1212íšŒì°¨, ë§ˆì§€ë§‰ ë‹¹ì²¨ë²ˆí˜¸(1211íšŒ) = [23,26,27,35,38,40]
        const lastWinning = FULL_DATA[0].slice(1, 7); // [23,26,27,35,38,40]
        const targetRound = 1212;
        basket = lottoSystem00001212Final(FULL_DATA, targetRound, lastWinning);

        // ê³ ì •ë²ˆí˜¸(machineFixed)ëŠ” basketì˜ ì²« 3ìˆ˜ë¡œ ì§€ì • (UI ì‹œê°íš¨ê³¼ìš©)
        machineFixed = basket.slice(0, 3);

        // í‰ê·  í•©ê³„ ê³„ì‚° (ê¸°ì¡´ ë¡œì§ ìœ ì§€ - ë‹¤ìŒ íšŒì°¨ ê¸°ëŒ€ í•©ê³„)
        let nextSums = [];
        const targetRange = 30;
        for(let i=1; i < targetRange; i++) {
            let currentNums = FULL_DATA[i].slice(1, 7);
            let top22Freq = []; // ì˜ˆì „ ë¡œì§ì—ì„œ í•„ìš”í–ˆë˜ ë¶€ë¶„, ê°„ì†Œí™”
            // ì‹¤ì œ dynamicAvgSum ê³„ì‚°ì„ ìœ„í•´ ê³¼ê±° ë°ì´í„° ë‹¨ìˆœ í•©ì‚°
            if (i+1 < FULL_DATA.length) {
                let sum = FULL_DATA[i+1].slice(1, 7).reduce((a,b)=>a+b, 0);
                nextSums.push(sum);
            }
        }
        if (nextSums.length > 0) {
            dynamicAvgSum = Math.round(nextSums.reduce((a,b)=>a+b, 0) / nextSums.length);
        }

        // ì›” í‘œì‹œ
        const today = new Date();
        const currentMonth = today.getMonth() + 1;
        const monthNames = ['','1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
        
        document.getElementById('status').innerHTML = `
            <div><span class="highlight-gold">â˜… 1ë²ˆì½”ë“œ í†µí•© ì—”ì§„ [${monthNames[currentMonth]}]</span></div>
            <div><span class="highlight-red">ğŸ¯ ë¯¸ì¶œìˆ˜(ìµœê·¼ 22íšŒ ê¸°ì¤€):</span> ${zeroFreqNums.length > 0 ? zeroFreqNums.join(', ') : 'ì—†ìŒ'}</div>
            <div>ì••ì¶• í›„ë³´ 17ìˆ˜: ${basket.join(', ')}</div>
            <div><span class="highlight-blue">ğŸ“Š ë‹¤ìŒ íšŒì°¨ ê¸°ëŒ€ í•©ê³„:</span> ${dynamicAvgSum}</div>
            <div><span class="highlight-blue">âš–ï¸ í•„í„°ë§ ë²”ìœ„:</span> ${dynamicAvgSum-28} ~ ${dynamicAvgSum+28}</div>
        `;
    }

    // ===== ì¡°í•© ìƒì„± í•¨ìˆ˜ (ê¸°ì¡´ ë¡œì§ ìœ ì§€, basketë§Œ 1ë²ˆì½”ë“œ ê²°ê³¼ë¡œ ëŒ€ì²´) =====
    function process(limit) {
        analyze(); // ë§¤ë²ˆ ìƒˆë¡œ ë¶„ì„ (basket ì—…ë°ì´íŠ¸)
        const box = document.getElementById('console');
        box.innerHTML = "";
        let count = 0, used = new Set(), safety = 0;
        let minSum = dynamicAvgSum - 28;
        let maxSum = dynamicAvgSum + 28;

        while(count < limit && safety < 10000) {
            safety++;
            let res = new Set();
            let currentIdx = count + 1;
            let zeroCount = 0;

            // 9,10ë²ˆ ì¡°í•© ë¯¸ì¶œìˆ˜ ê°•ì œ í¬í•¨ (UI ë””ìì¸ ìœ ì§€)
            if (limit === 10 && (currentIdx === 9 || currentIdx === 10) && zeroFreqNums.length > 0) {
                let availableZeros = [...zeroFreqNums];
                let maxPossible = Math.min(4, availableZeros.length);
                let selectCount = Math.floor(Math.random() * maxPossible) + 1;
                
                for(let i = 0; i < selectCount; i++) {
                    if(availableZeros.length === 0) break;
                    let randomIndex = Math.floor(Math.random() * availableZeros.length);
                    let selectedNum = availableZeros[randomIndex];
                    res.add(selectedNum);
                    zeroCount++;
                    availableZeros.splice(randomIndex, 1);
                }
            } else if (Math.random() > 0.8 && zeroFreqNums.length > 0 && zeroCount < 2) {
                let zeroNum = zeroFreqNums[Math.floor(Math.random() * zeroFreqNums.length)];
                res.add(zeroNum);
                zeroCount++;
            }

            // 5ì¡°í•©ì¼ ë•Œ ê³ ì •ë²ˆí˜¸ 1ê°œ í¬í•¨ (ê¸°ì¡´ ë¡œì§)
            if(limit === 5) res.add(machineFixed[Math.floor(Math.random()*3)]);

            // basketì—ì„œ ëœë¤í•˜ê²Œ ì¶”ê°€
            let shuffleBasket = [...basket].sort(() => Math.random() - 0.5);
            for(let n of shuffleBasket) {
                if(res.size >= 6) break;
                
                if(zeroFreqNums.includes(n)) {
                    if(zeroCount < 2) {
                        res.add(n);
                        zeroCount++;
                    }
                } else {
                    res.add(n);
                }
            }

            // ë¶€ì¡±ë¶„ ëœë¤ ì±„ì›€
            while(res.size < 6) {
                let rand = Math.floor(Math.random()*45)+1;
                if(zeroFreqNums.includes(rand)) {
                    if(zeroCount < 2) {
                        res.add(rand);
                        zeroCount++;
                    }
                } else {
                    res.add(rand);
                }
            }

            let finalArr = Array.from(res).sort((a,b)=>a-b);
            let sum = finalArr.reduce((a,b)=>a+b, 0);
            let key = finalArr.join(',');

            if(!used.has(key) && sum >= minSum && sum <= maxSum) {
                used.add(key);
                count++;
                let specialMark = (limit === 10 && (count === 9 || count === 10)) ? 'ğŸ”¥' : '';
                renderRow(finalArr, box, key, specialMark);
            }
        }
    }

    function renderRow(arr, target, key, specialMark = '') {
        const html = arr.map(n => {
            let cls = machineFixed.includes(n) ? "fixed" : (zeroFreqNums.includes(n) ? "zero" : "normal");
            return `<span class="num-box ${cls}">${n}</span>`;
        }).join('');
        let specialHtml = specialMark ? `<span class="badge">${specialMark}</span>` : '';
        target.innerHTML += `<div class="row-line"><div class="num-container">${html}</div><div style="display: flex; align-items: center;">${specialHtml}<div class="save-btn" onclick="saveToBox('${key}')">ì €ì¥</div></div></div>`;
    }

    function openPopup() {
        document.getElementById('popup').style.display = 'flex';
        renderStorage();
    }

    function closePopup() {
        document.getElementById('popup').style.display = 'none';
    }

    function clearStorage() {
        if(confirm("ë³´ê´€í•¨ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")) {
            savedNumbers = [];
            const storageKey = `lottoSave_${userName}`;
            localStorage.removeItem(storageKey);
            renderStorage();
        }
    }
    
    window.onload = function() {
        initUser();
        analyze();
    };
</script>
</body>
</html>
