<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SHIN-UI-SON Â· ëª¨ë°”ì¼ ë§ì¶¤í˜•</title>
    <style>
        /* ê¸°ì¡´ ë ˆì´ì•„ì›ƒ ìœ ì§€, ê°€ë¡œ í­ ë³µì› ë° ê°€ë…ì„± ì¡°ì • */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a0a;
            color: #f0f0f0;
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            padding: 4px;               /* ê¸°ì¡´ 2px â†’ ì•½ê°„ ì—¬ìœ  */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .outer-border {
            border: 1px solid #ffd700;
            border-radius: 12px;
            padding: 6px;                /* ê¸°ì¡´ 4px â†’ ì•½ê°„ ëŠ˜ë¦¼ */
            max-width: 480px;            /* ê¸°ì¡´ê°’ ìœ ì§€, ë„ˆë¹„ ë³µì› */
            margin: 0 auto;
            width: 100%;
            background: #0a0a0a;
        }
        .header-line {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #1a1a1a;
            border-radius: 30px;
            padding: 6px 10px;
            margin-bottom: 8px;
            font-size: 13px;
            flex-wrap: wrap;
            gap: 5px;
        }
        .prev-info {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #aaa;
            flex-wrap: wrap;
        }
        .base-num-box {
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            font-size: 12px;
            font-weight: 800;
            border-radius: 50%;
            background: #111;
            color: #ffd700;
            border: 1.5px solid #ffd700;
        }
        .title-main {
            font-weight: 800;
            background: linear-gradient(135deg, #fff8e0, #ffe68f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 17px;
            white-space: nowrap;
        }
        .round-text {
            color: #ffd700;
            font-weight: 900;
            font-size: 15px;
            white-space: nowrap;
        }
        .user-info {
            background: #222;
            color: #00e6b8;
            padding: 4px 10px;
            border-radius: 40px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        .change-name-btn {
            background: #00e6b8;
            color: #000;
            border: none;
            border-radius: 30px;
            padding: 3px 8px;
            font-size: 10px;
            cursor: pointer;
            height: 26px;
            line-height: 1;
        }
        .status-info {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #333;
            font-size: 13px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
            color: #fff;
        }
        .stat-row {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin: 6px 0;
            flex-wrap: wrap;
        }
        .stat-label {
            color: #00e6b8;
            font-weight: 600;
            font-size: 13px;
            min-width: 60px;             /* ë ˆì´ë¸” ë„“ì´ í™•ë³´ */
        }
        .number-group {
            display: inline-flex;
            flex-wrap: wrap;               /* ê·¸ë˜ë„ í•„ìš”ì‹œ ì¤„ë°”ê¿ˆ í—ˆìš© */
            align-items: center;
            gap: 3px 5px;
            font-size: 13px;
            max-width: calc(100% - 70px); /* ë ˆì´ë¸” ê¸¸ì´ë§Œí¼ ì—¬ìœ  */
            overflow-x: auto;              /* ë„ˆë¬´ ê¸¸ë©´ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
            white-space: nowrap;           /* ê¸°ë³¸ì ìœ¼ë¡œ í•œ ì¤„ì— í‘œì‹œ ì‹œë„ */
            padding-bottom: 2px;
            -webkit-overflow-scrolling: touch;
        }
        /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ì•ˆì—ì„œ ìˆ«ìë“¤ì´ ë­‰ì¹˜ì§€ ì•Šë„ë¡ */
        .number-group span {
            display: inline-block;
            margin-right: 2px;
            font-size: 13px;
            white-space: nowrap;
        }
        .ai-number { font-size: 14px; font-weight: bold; }
        .full14-number { font-size: 13px; }
        .b-number { font-size: 12px; }
        .survivor-number { font-size: 12px; }
        .winning-num { color: #2ecc71 !important; font-weight: bold; }
        .replaced-in-text { color: #ff6b6b !important; font-weight: bold; }
        .replaced-out-text { color: #6ba6ff !important; font-weight: bold; }
        .bonus-text { color: #aaa; }

        .control-panel {
            background: rgba(255,255,255,0.02);
            border-radius: 30px;
            padding: 8px 10px;
            margin: 8px 0;
            border: 1px solid #333;
        }
        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-around;
            gap: 6px;
            flex-wrap: wrap;
        }
        .setting-item {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #222;
            padding: 4px 10px;
            border-radius: 40px;
        }
        .setting-item span {
            color: #ffd700;
            font-size: 12px;
        }
        .setting-item input {
            width: 50px;
            height: 32px;
            background: #333;
            border: 1px solid #00e6b8;
            color: white;
            border-radius: 40px;
            text-align: center;
            font-size: 13px;
            margin: 0 2px;
        }
        .step-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #333;
            border: 2px solid #ffd700;
            color: #ffd700;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 22px;
            line-height: 1;
            box-shadow: 0 0 5px rgba(255,215,0,0.5);
        }
        .apply-btn {
            background: #00e6b8;
            color: #000;
            border: none;
            border-radius: 40px;
            padding: 6px 16px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            height: 38px;
        }

        .round-selector {
            margin: 8px 0;
            text-align: center;
        }
        .base-round-input {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }
        .round-control {
            display: flex;
            align-items: center;
            gap: 4px;
            background: #222;
            padding: 4px 12px;
            border-radius: 40px;
        }
        .round-control input {
            width: 70px;
            height: 38px;
            background: #333;
            border: 1px solid #ffd700;
            color: white;
            border-radius: 40px;
            text-align: center;
            font-size: 14px;
        }
        .round-control .step-btn {
            width: 36px;
            height: 36px;
            font-size: 22px;
        }
        .base-round-input button {
            background: #00e6b8;
            color: #000;
            border: none;
            border-radius: 40px;
            padding: 0 20px;
            height: 38px;
            font-size: 13px;
            font-weight: bold;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 4px;
            margin: 8px 0 4px;
        }
        button {
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            height: 40px;
            font-size: 13px;
            padding: 0 5px;
        }
        .btn-5set { background: linear-gradient(145deg, #00e6b8, #00a884); color: #000; }
        .btn-main { background: linear-gradient(145deg, #ffd700, #b8860b); color: #000; }
        .btn-sub { background: #2a2a2a; color: #ddd; border: 1px solid #444; }
        .btn-reset { grid-column: span 3; background: #333; color: #aaa; height: 36px; font-size: 12px; }
        .btn-review { grid-column: span 3; background: linear-gradient(145deg, #ff69b4, #c71585); color: white; height: 40px; font-size: 13px; }

        .small-note {
            color: #aaa;
            font-size: 11px;
            text-align: center;
            margin-top: 5px;
        }

        /* íŒì—… ë“± ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ (ê°„ëµí™”) */
        .popup-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .popup-content {
            background: #1a1a1a;
            border: 1px solid #ffd700;
            border-radius: 20px;
            padding: 15px;
            max-width: 440px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
        }
        /* ë‚˜ë¨¸ì§€ íŒì—… ë‚´ë¶€ ìŠ¤íƒ€ì¼ì€ ê¸°ì¡´ê³¼ ë™ì¼ (ìƒëµ ê°€ëŠ¥) */
        .toast {
            position: fixed; bottom: 20px; left: 0; width: 100%; text-align: center; z-index: 9999; display: none;
        }
        .toast span {
            background: #333; color: #ffd700; padding: 6px 16px; border-radius: 40px; font-size: 13px;
        }
        /* ê²Œì„ ê´€ë ¨ ìµœì†Œ ìŠ¤íƒ€ì¼ */
        .game-canvas { width: 100%; height: 200px; background: #111; border-radius: 16px; touch-action: none; }
        .selected-numbers { display: flex; gap: 5px; justify-content: center; flex-wrap: wrap; margin: 8px 0; }
        .selected-ball { width: 38px; height: 38px; border-radius: 50%; background: #000; border: 2px solid #ffd700; color: #ffd700; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; }
    </style>
</head>
<body>
<div class="outer-border">
    <div class="header-line">
        <div class="prev-info">
            <span id="prevWinLabel">ğŸ“Œ 1212íšŒ</span>
            <span id="baseRoundInfo"></span>
        </div>
        <span class="title-main">SHIN-UI-SON</span>
        <span class="round-text" id="roundDisplay">1213 ì„¤ì •</span>
        <span id="userDisplay" class="user-info"></span>
    </div>

    <div id="status" class="status-info">ë¡œë”© ì¤‘...</div>

    <div class="control-panel">
        <div class="setting-row">
            <div class="setting-item">
                <span>ê°„ê²©</span>
                <button class="step-btn" onclick="stepInterval(-1)">âˆ’</button>
                <input type="number" id="intervalWeeks" min="1" max="30" value="1" step="1">
                <button class="step-btn" onclick="stepInterval(1)">+</button>
                <span>ì£¼</span>
            </div>
            <div class="setting-item">
                <span>íšŒì°¨ ìˆ˜</span>
                <button class="step-btn" onclick="stepRefCount(-1)">âˆ’</button>
                <input type="number" id="refCount" min="1" max="30" value="10" step="1">
                <button class="step-btn" onclick="stepRefCount(1)">+</button>
                <span>ê°œ</span>
            </div>
            <button class="apply-btn" onclick="applyAnalysisSettings()">ì ìš©</button>
        </div>
    </div>

    <div class="round-selector">
        <div class="base-round-input">
            <div class="round-control">
                <button class="step-btn" onclick="stepBaseRound(-1)">âˆ’</button>
                <input type="number" id="baseRoundInput" min="901" max="1300" value="1213" step="1">
                <button class="step-btn" onclick="stepBaseRound(1)">+</button>
            </div>
            <button onclick="setBaseRound()">íšŒì°¨ ì„¤ì •</button>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn-5set" onclick="process(5)">5ì¡°í•©</button>
        <button class="btn-main" onclick="process(10)">10ì¡°í•©</button>
        <button class="btn-sub" onclick="openPopup()">ë³´ê´€í•¨</button>
        <button class="btn-sub" onclick="openGamePopup()">ğŸ® ê²Œì„</button>
        <button class="btn-sub" onclick="clearStorage()">ì´ˆê¸°í™”</button>
        <button class="btn-sub" onclick="location.reload()">âŸ³</button>
        <button class="btn-review" onclick="openReviewPopup()">ğŸ“Š ë‹¹ì²¨í™•ì¸</button>
        <button class="btn-sub" style="grid-column: span 3;" onclick="showComboList()">ğŸ“‹ ìƒì„± ì¡°í•©</button>
    </div>

    <div class="small-note">ğŸ¯ <span id="targetRound">1213</span> ì˜ˆìƒ (10ìˆ˜ ì—”ì§„) Â· 14ìˆ˜ í‘œì‹œ</div>
</div>

<div class="toast" id="toast"><span>âœ… ì €ì¥ë¨</span></div>

<!-- íŒì—…ë“¤ (ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼, ìƒëµí•˜ì§€ ì•Šê³  í•„ìš”í•œ ë¶€ë¶„ë§Œ ê°„ë‹¨íˆ í‘œì‹œ) -->
<div id="popup" class="popup-overlay" style="display:none;" onclick="if(event.target===this) closePopup()"><div class="popup-content"><button class="popup-close" style="float:right; background:none; border:none; color:#ffd700; font-size:20px;" onclick="closePopup()">&times;</button><div class="popup-title" style="font-size:16px; margin-bottom:10px;">ğŸ“¦ ë³´ê´€í•¨</div><div id="storage"></div></div></div>
<div id="gamePopup" class="popup-overlay" style="display:none;" onclick="if(event.target===this) closeGamePopup()"><div class="popup-content"><button class="popup-close" style="float:right; background:none; border:none; color:#ffd700; font-size:20px;" onclick="closeGamePopup()">&times;</button><div class="popup-title">ğŸ® ê²Œì„ì„¼í„°</div><div class="game-tabs" style="display:flex; gap:5px; margin-bottom:10px;"><button class="game-tab active" data-game="touch" onclick="switchGame('touch')">í„°ì¹˜ ëŸ¬ì‰¬</button><button class="game-tab" data-game="reaction" onclick="switchGame('reaction')">ë°˜ì‘ì†ë„</button></div><div id="touchGame" class="game-panel active"><canvas id="gameCanvas" class="game-canvas" width="400" height="200"></canvas><div class="selected-numbers" id="selectedNumbersContainer"></div><div style="font-size:11px; color:#888;">* 6ê°œ ì„ íƒ</div><div class="game-btn-group" style="display:flex; gap:8px; justify-content:center;"><button class="game-btn" style="background:#00e6b8; color:#000; border:none; border-radius:30px; padding:8px 16px;" onclick="resetTouchGame()">ë¦¬ì…‹</button><button class="game-btn" id="saveComboBtn" style="background:#00e6b8; color:#000; border:none; border-radius:30px; padding:8px 16px;" onclick="saveTouchCombo()" disabled>ì €ì¥</button></div></div><div id="reactionGame" class="game-panel" style="display:none;"><div class="reaction-box" id="reactionBox" style="width:100%; height:120px; background:#222; border-radius:16px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:16px; cursor:pointer; margin:10px 0;" onclick="handleReactionClick()">ì‹œì‘</div><div class="reaction-result" id="reactionResult" style="font-size:13px; color:#ffd700; text-align:center;"></div><div class="selected-numbers" id="reactionSelectedContainer"></div><div class="game-btn-group" style="display:flex; gap:8px; justify-content:center;"><button class="game-btn" onclick="resetReactionGame()">ë¦¬ì…‹</button><button class="game-btn" id="saveReactionBtn" onclick="saveReactionCombo()" disabled>ì €ì¥</button><button class="game-btn" onclick="startReaction()">ìƒˆ ê²Œì„</button></div></div></div></div>
<div id="reviewPopup" class="popup-overlay" style="display:none;" onclick="if(event.target===this) closeReviewPopup()"><div class="popup-content"><button class="popup-close" style="float:right; background:none; border:none; color:#ffd700; font-size:20px;" onclick="closeReviewPopup()">&times;</button><div class="popup-title" id="reviewTitle">ğŸ“Š ë³µê¸°</div><div class="winning-display" id="winningDisplay"></div><div class="ai-info-box" id="reviewAIInfo"></div><div class="winning-input" style="display:flex; gap:5px; flex-wrap:wrap; justify-content:center;"><input type="number" id="win1" min="1" max="45" placeholder="1" style="width:45px; height:45px; background:#222; border:1px solid #444; border-radius:50%; text-align:center; color:#fff;"><!-- ë‚˜ë¨¸ì§€ 5ê°œ ë™ì¼, ìƒëµ --></div><div class="bonus-section"><div>ë³´ë„ˆìŠ¤ ë²ˆí˜¸</div><input type="number" id="bonus" min="1" max="45" placeholder="ë³´ë„ˆìŠ¤" style="width:45px; height:45px; background:#222; border:1px solid #444; border-radius:50%; text-align:center; color:#fff;"></div><button class="btn-compare" onclick="compareNumbers()">ë¹„êµí•˜ê¸°</button><div id="reviewResult" class="result-box"></div></div></div>
<div id="comboListPopup" class="popup-overlay" style="display:none;" onclick="if(event.target===this) closeComboListPopup()"><div class="popup-content"><button class="popup-close" style="float:right; background:none; border:none; color:#ffd700; font-size:20px;" onclick="closeComboListPopup()">&times;</button><div class="popup-title">ğŸ“‹ ì¡°í•© ëª©ë¡</div><div style="text-align:right;"><button class="combo-save-btn" onclick="saveAllCombos()">ğŸ“¥ ëª¨ë‘ ì €ì¥</button></div><div id="comboListContent" class="combo-list"></div></div></div>

<script>
    // ===== ë™ì¼í•œ ë°ì´í„° ë° í•¨ìˆ˜ (ì´ì „ ì½”ë“œ ê·¸ëŒ€ë¡œ ìœ ì§€, ë‹¨ ê²Œì„/íŒì—… í•¨ìˆ˜ëŠ” ê°„ëµí™”ë˜ì–´ ìˆìœ¼ë‚˜ í•µì‹¬ ë™ì‘ ë³´ì¡´) =====
    const FULL_DATA = [ [1212,5,8,25,31,41,44,45], [1211,23,26,27,35,38,40,10], [1210,1,7,9,17,27,38,31], [1209,2,17,20,35,37,39,24], [1208,6,27,30,36,38,42,25], [1207,10,22,24,27,38,45,11], [1206,1,3,17,26,27,42,23], [1205,1,4,16,23,31,41,2], [1204,8,16,28,30,31,44,27], [1203,3,6,18,29,35,39,24], [1202,5,12,21,33,37,40,7], [1201,7,9,24,27,35,36,37], [1200,1,2,4,16,20,32,45], [1199,16,24,25,30,31,32,7], [1198,26,30,33,38,39,41,21], [1197,1,5,7,26,28,43,30], [1196,8,12,15,29,40,45,14], [1195,3,15,27,33,34,36,37], [1194,3,13,15,24,33,37,2], [1193,6,9,16,19,24,28,17], [1192,10,16,23,36,39,40,11], [1191,1,4,11,12,20,41,2], [1190,7,9,19,23,26,45,33], [1189,9,19,29,35,37,38,31], [1188,3,4,12,19,22,27,9], [1187,5,13,26,29,37,40,42], [1186,2,8,13,16,23,28,35], [1185,6,17,22,28,29,32,38], [1184,14,16,23,25,31,37,42], [1183,4,15,17,23,27,36,31], [1182,1,13,21,25,28,31,22], [1181,8,10,14,20,33,41,28], [1180,6,12,18,37,40,41,3], [1179,3,16,18,24,40,44,21], [1178,5,6,11,27,43,44,17], [1177,3,7,15,16,19,43,21], [1176,7,9,11,21,30,35,29], [1175,3,4,6,8,32,42,31], [1174,8,11,14,17,36,39,22], [1173,1,5,18,20,30,35,3], [1172,7,9,24,40,42,44,45], [1171,3,6,7,11,12,17,19], [1170,3,13,28,34,38,42,25], [1169,5,12,24,26,39,42,20], [1168,9,21,24,30,33,37,29], [1167,8,23,31,35,39,40,24], [1166,14,23,25,27,29,42,16], [1165,6,7,27,29,38,45,17], [1164,17,18,23,25,38,39,22], [1163,2,13,15,16,33,43,4], [1162,20,21,22,25,28,29,6], [1161,2,12,20,24,34,42,37], [1160,7,13,18,36,39,45,19], [1159,3,9,27,28,38,39,7], [1158,21,25,27,32,37,38,20], [1157,5,7,12,20,25,26,28], [1156,30,31,34,39,41,45,7], [1155,10,16,19,27,37,38,13], [1154,4,8,22,26,32,38,27], [1153,1,9,10,13,35,44,5], [1152,30,31,32,35,36,37,5], [1151,2,3,9,15,27,29,8], [1150,8,9,18,35,39,45,25], [1149,8,15,19,21,32,36,38], [1148,3,6,13,15,16,22,32], [1147,7,11,24,26,27,37,32], [1146,6,11,17,19,40,43,28], [1145,2,11,31,33,37,44,32], [1144,3,4,12,15,26,34,6], [1143,10,16,17,27,28,36,6], [1142,2,8,28,30,37,41,22], [1141,7,11,12,21,26,35,20], [1140,7,10,22,29,31,38,15], [1139,5,12,15,30,37,40,18], [1138,14,16,19,20,29,34,35], [1137,4,9,12,15,33,45,26], [1136,21,33,35,38,42,44,1], [1135,1,6,13,19,21,33,4], [1134,3,7,9,13,19,24,23], [1133,13,14,20,28,29,34,23], [1132,6,7,19,28,34,41,5], [1131,1,2,6,14,27,38,33], [1130,15,19,21,25,27,28,40], [1129,5,10,11,17,28,34,22], [1128,1,5,8,16,28,33,45], [1127,10,15,24,30,31,37,32], [1126,4,5,9,11,37,40,7], [1125,6,14,25,33,40,44,30], [1124,3,8,17,30,33,34,28], [1123,13,19,21,24,34,35,26], [1122,3,6,21,30,34,35,22], [1121,6,24,31,32,38,44,8], [1120,2,19,26,31,38,41,34], [1119,1,9,12,13,20,45,3], [1118,11,13,14,15,16,45,3], [1117,3,4,9,30,33,36,7], [1116,15,16,17,25,30,31,32], [1115,7,12,23,32,34,36,8], [1114,10,16,19,32,33,38,3], [1113,11,13,20,21,32,44,8], [1112,16,20,26,36,42,44,24], [1111,3,13,30,33,43,45,4], [1110,3,7,11,20,22,41,24], [1109,10,12,13,19,33,40,2], [1108,7,19,26,37,39,44,27], [1107,6,14,30,31,40,41,29], [1106,1,3,4,29,42,45,36], [1105,6,16,34,37,39,40,11], [1104,1,7,21,30,35,38,2], [1103,10,12,29,31,40,44,2], [1102,13,14,22,26,37,38,20], [1101,6,7,13,28,36,42,41], [1100,17,26,29,30,31,43,12], [1099,3,20,28,38,40,43,4], [1098,12,16,21,24,41,43,15], [1097,14,33,34,35,37,40,4], [1096,1,12,16,19,23,43,34], [1095,8,14,28,29,34,40,12], [1094,6,7,15,22,26,40,41], [1093,10,17,22,30,35,43,44], [1092,7,18,19,26,33,45,37], [1091,6,20,23,24,28,30,44], [1090,12,19,21,29,40,45,1], [1089,4,18,31,37,42,43,40], [1088,11,21,22,30,39,44,31], [1087,13,14,18,21,34,44,16], [1086,11,16,25,27,35,36,37], [1085,4,7,17,18,38,44,36], [1084,8,12,13,29,33,42,5], [1083,3,7,14,15,22,38,17], [1082,21,26,27,32,34,42,31], [1081,1,9,16,23,24,38,17], [1080,13,16,23,31,36,44,38], [1079,4,8,18,24,37,45,6], [1078,6,10,11,14,36,38,43], [1077,4,8,17,30,40,43,34], [1076,3,7,9,33,36,37,10], [1075,1,23,24,35,44,45,10], [1074,1,6,20,27,28,41,15], [1073,6,18,28,30,32,38,15], [1072,16,18,20,23,32,43,27], [1071,1,2,11,21,30,35,39], [1070,3,6,14,22,30,41,36], [1069,1,10,18,22,28,31,44], [1068,4,7,19,26,33,35,3], [1067,7,10,19,23,28,33,18], [1066,6,11,16,19,21,32,45], [1065,3,18,19,23,32,45,24], [1064,3,6,9,18,22,35,14], [1063,3,6,22,23,24,38,30], [1062,20,31,32,40,41,45,12], [1061,4,24,27,35,37,45,15], [1060,3,10,24,33,38,45,36], [1059,7,10,22,25,34,40,27], [1058,11,23,25,30,32,40,42], [1057,8,13,19,27,40,45,12], [1056,13,20,24,32,36,45,29], [1055,4,7,12,14,22,33,31], [1054,14,19,27,28,30,45,33], [1053,22,26,29,30,34,45,15], [1052,5,17,26,27,35,38,1], [1051,21,26,30,32,33,35,44], [1050,6,12,31,35,38,43,17], [1049,3,5,13,20,21,37,17], [1048,6,12,17,21,32,39,30], [1047,2,20,33,40,42,44,32], [1046,7,16,25,29,35,36,28], [1045,6,14,15,19,21,41,37], [1044,12,17,20,26,28,36,4], [1043,3,5,12,22,26,31,19], [1042,5,14,15,23,34,43,4], [1041,6,7,9,11,17,18,45], [1040,8,16,26,29,31,36,11], [1039,2,3,6,19,36,39,26], [1038,7,16,24,27,37,44,2], [1037,2,14,15,22,27,33,31], [1036,2,5,22,32,34,45,39], [1035,9,14,34,35,41,42,2], [1034,26,31,32,33,38,40,11], [1033,3,11,15,20,35,44,10], [1032,1,6,12,19,36,42,28], [1031,6,7,22,32,35,36,19], [1030,2,5,11,17,24,29,9], [1029,12,30,32,37,39,41,24], [1028,5,7,12,13,18,35,23], [1027,14,16,27,35,39,45,5], [1026,5,12,13,31,32,41,34], [1025,8,9,20,25,29,33,7], [1024,9,18,20,22,38,44,10], [1023,10,14,16,18,29,35,25], [1022,5,6,11,29,42,45,28], [1021,12,15,17,24,29,45,16], [1020,12,27,29,38,41,45,6], [1019,1,4,13,17,34,39,6], [1018,3,19,21,25,37,45,35], [1017,12,18,22,23,30,34,32], [1016,15,26,28,34,41,42,44], [1015,14,23,31,33,37,40,44], [1014,3,11,14,18,26,27,21], [1013,21,22,26,34,36,41,32], [1012,5,11,18,20,35,45,3], [1011,1,9,12,26,35,38,42], [1010,9,12,15,25,34,36,3], [1009,15,23,29,34,40,44,20], [1008,9,11,30,31,41,44,33], [1007,8,11,16,19,21,25,40], [1006,8,11,15,16,17,37,36], [1005,8,13,18,24,27,29,17], [1004,7,15,30,37,39,44,18], [1003,1,4,29,39,43,45,31], [1002,17,25,33,35,38,45,15], [1001,6,10,12,14,20,42,15], [1000,2,8,19,22,32,42,39], [999,1,3,9,14,18,28,34], [998,13,17,18,20,42,45,41], [997,4,7,14,16,24,44,20], [996,6,11,15,24,32,39,28], [995,1,4,13,29,38,39,7], [994,1,3,8,24,27,35,28], [993,6,14,16,18,24,42,44], [992,12,20,26,33,44,45,24], [991,13,18,25,31,33,44,38], [990,2,4,25,26,36,37,28], [989,17,18,21,27,29,33,26], [988,2,13,20,30,31,41,27], [987,2,4,15,23,29,38,7], [986,7,10,16,28,41,42,40], [985,17,21,23,30,34,44,19], [984,3,10,23,35,36,37,18], [983,13,23,26,31,35,43,15], [982,5,7,13,20,21,44,33], [981,27,36,37,41,43,45,32], [980,3,13,16,23,24,35,14], [979,7,11,16,21,27,33,24], [978,1,7,15,32,34,42,8], [977,2,9,10,14,22,44,16], [976,4,12,14,25,35,37,2], [975,7,8,9,17,22,24,5], [974,1,2,11,16,39,44,32], [973,22,26,31,37,41,42,24], [972,3,6,17,23,37,39,26], [971,2,6,17,18,21,26,7], [970,9,11,16,21,28,36,5], [969,3,9,10,29,40,45,7], [968,2,5,12,14,24,39,33], [967,1,6,13,37,38,40,9], [966,1,21,25,29,34,37,36], [965,2,13,25,28,29,36,34], [964,6,21,36,38,39,43,30], [963,6,12,19,23,34,42,35], [962,1,18,28,31,34,43,40], [961,11,20,29,31,33,42,43], [960,2,18,24,30,32,45,14], [959,1,14,15,24,40,41,35], [958,2,9,10,16,35,37,1], [957,4,15,24,35,36,40,1], [956,10,11,20,21,25,41,40], [955,4,9,23,26,29,33,8], [954,1,9,26,28,30,41,32], [953,7,9,22,27,37,42,34], [952,4,12,22,24,33,41,38], [951,2,12,30,31,39,43,38], [950,3,4,15,22,28,40,10], [949,14,21,35,36,40,44,30], [948,13,18,30,31,38,41,5], [947,3,8,17,20,27,35,26], [946,9,18,19,30,34,40,20], [945,9,10,15,30,33,37,26], [944,2,13,16,19,32,33,42], [943,1,8,13,36,44,45,39], [942,10,12,18,35,42,43,39], [941,12,14,25,27,39,40,35], [940,3,15,20,22,24,41,11], [939,4,11,28,39,42,45,6], [938,4,8,10,16,31,36,9], [937,2,10,13,22,29,40,26], [936,7,11,13,17,18,29,43], [935,4,10,20,32,38,44,18], [934,1,3,30,33,36,39,12], [933,23,27,29,31,36,45,37], [932,1,6,15,36,37,38,5], [931,14,15,23,25,35,43,32], [930,8,21,25,38,39,44,28], [929,7,9,12,15,19,23,4], [928,3,4,10,20,28,44,30], [927,4,15,22,38,41,43,26], [926,10,16,18,20,25,31,6], [925,13,24,32,34,39,42,4], [924,3,11,34,42,43,44,13], [923,3,17,18,23,36,41,26], [922,2,6,13,17,27,43,36], [921,5,7,12,22,28,41,1], [920,2,3,26,33,34,43,29], [919,9,14,17,18,42,44,35], [918,7,11,12,31,33,38,5], [917,1,3,23,24,27,43,34], [916,6,21,22,32,35,36,17], [915,2,6,11,13,22,37,14], [914,16,19,24,33,42,44,27], [913,6,14,16,21,27,37,40], [912,5,8,18,21,22,38,10], [911,4,5,12,14,32,42,35], [910,1,11,17,27,35,39,31], [909,7,24,29,30,34,35,33], [908,3,16,21,22,23,44,30], [907,21,27,29,38,40,44,37], [906,2,5,14,28,31,32,20], [905,3,4,16,27,38,40,20], [904,2,6,8,26,43,45,11], [903,2,15,16,21,22,28,45], [902,7,19,23,24,36,39,30], [901,5,18,20,23,30,34,21], [900,7,13,16,18,35,38,14] ];

    let basket = [], survivors = [], zeroFreqNums = [], dynamicAvgSum = 145;
    let userName = "", savedNumbers = [], currentBaseRound = 1213, generatedCombos = [];
    let weightedScore = {}, middle = [], bonusNums = [], compressedOut4 = [], full14 = [];
    let replacedIn = [], replacedOut = [];
    let intervalWeeks = 1, referenceCount = 10;
    let touchGame = null, touchInterval = null, touchSelected = [], reactionSelected = [], reactionState = 'idle', reactionTimer = null, reactionStartTime = 0;

    // í•¨ìˆ˜ë“¤ì€ ì´ì „ê³¼ ë™ì¼ (ê¸¸ì´ ê´€ê³„ë¡œ ìƒëµí•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ìœ ì§€)
    function stepInterval(delta) { let i = parseInt(document.getElementById('intervalWeeks').value) + delta; if(i<1)i=1; if(i>30)i=30; document.getElementById('intervalWeeks').value = i; }
    function stepRefCount(delta) { let i = parseInt(document.getElementById('refCount').value) + delta; if(i<1)i=1; if(i>30)i=30; document.getElementById('refCount').value = i; }
    function stepBaseRound(delta) { let i = parseInt(document.getElementById('baseRoundInput').value) + delta; if(i<901)i=901; if(i>1300)i=1300; document.getElementById('baseRoundInput').value = i; }
    function updateUserDisplay() { document.getElementById('userDisplay').innerHTML = `ğŸ‘¤ ${userName} <button class="change-name-btn" onclick="changeName()">âœ</button> <button class="change-name-btn" style="background:#ff4444;" onclick="deleteUser()">âœ•</button>`; }
    function changeName() { let n = prompt("ì´ë¦„", userName); if (n && n.trim()) { userName = n.trim(); localStorage.setItem('lottoUserName', userName); savedNumbers = JSON.parse(localStorage.getItem(`lottoSave_${userName}`)) || []; updateUserDisplay(); showToast('ì´ë¦„ ë³€ê²½'); } }
    function deleteUser() { if(confirm("ì‚­ì œ?")) { localStorage.removeItem(`lottoSave_${userName}`); userName = "guest_" + Math.random().toString(36).substring(2,6); localStorage.setItem('lottoUserName', userName); savedNumbers = []; updateUserDisplay(); showToast('ìƒˆ ê³„ì •'); } }
    function initUser() { let s = localStorage.getItem('lottoUserName'); if (s) userName = s; else { userName = "guest_" + Math.random().toString(36).substring(2,6); localStorage.setItem('lottoUserName', userName); } savedNumbers = JSON.parse(localStorage.getItem(`lottoSave_${userName}`)) || []; updateUserDisplay(); }
    function showToast(m) { let t = document.getElementById('toast'); t.querySelector('span').innerText = m; t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 800); }
    function saveToBox(s) { if (!savedNumbers.includes(s)) { savedNumbers.push(s); localStorage.setItem(`lottoSave_${userName}`, JSON.stringify(savedNumbers)); showToast('âœ… ì €ì¥'); } else showToast('âš ï¸ ì¤‘ë³µ'); }
    function saveAllCombos() { if (generatedCombos.length === 0) { showToast('ì¡°í•© ì—†ìŒ'); return; } let cnt = 0; generatedCombos.forEach(c => { if (!savedNumbers.includes(c.key)) { savedNumbers.push(c.key); cnt++; } }); if (cnt) { localStorage.setItem(`lottoSave_${userName}`, JSON.stringify(savedNumbers)); showToast(`ğŸ“¦ ${cnt}ê°œ ì €ì¥`); } else showToast('ëª¨ë‘ ì¤‘ë³µ'); }
    function deleteSingleItem(i) { if (confirm("ì‚­ì œ?")) { savedNumbers.splice(i, 1); localStorage.setItem(`lottoSave_${userName}`, JSON.stringify(savedNumbers)); renderStorage(); showToast('ğŸ—‘ï¸ ì‚­ì œ'); } }
    function loadFromStorage(n) { alert(n.split(',').join(', ')); closePopup(); }
    function renderStorage() { let st = document.getElementById('storage'); if (savedNumbers.length === 0) { st.innerHTML = '<div style="text-align:center;">ì €ì¥ ì—†ìŒ</div>'; return; } st.innerHTML = savedNumbers.map((n, i) => { let nums = n.split(','); return `<div style="display:flex; justify-content:space-between; padding:4px; border-bottom:1px solid #333;">${nums.map(v => `<span style="color:#fff; font-size:13px; margin-right:4px;">${v}</span>`).join('')}<div><button class="combo-save-btn" style="background:#00e6b8; color:#000; border:none; border-radius:20px; padding:4px 8px; margin-right:4px;" onclick="loadFromStorage('${n}')">ë¶ˆëŸ¬ì˜¤ê¸°</button><button class="combo-save-btn" style="background:#ff4444; color:#fff; border:none; border-radius:20px; padding:4px 8px;" onclick="deleteSingleItem(${i})">ì‚­ì œ</button></div></div>`; }).join(''); }
    function applyAnalysisSettings() { let i = parseInt(document.getElementById('intervalWeeks').value); let c = parseInt(document.getElementById('refCount').value); if (i >= 1 && i <= 30 && c >= 1 && c <= 30) { intervalWeeks = i; referenceCount = c; analyze(); showToast(`ê°„ê²© ${i}ì£¼, íšŒì°¨ ìˆ˜ ${c}ê°œ`); } else alert('ê°„ê²© 1~30, íšŒì°¨ ìˆ˜ 1~30 ì‚¬ì´ë¡œ ì…ë ¥í•˜ì„¸ìš”'); }

    function analyze() {
        const target = currentBaseRound, prev = target - 1;
        const p = FULL_DATA.find(x => x[0] === prev);
        if (!p) { alert(`${prev} ë°ì´í„° ì—†ìŒ`); return; }
        const lastWinning = p.slice(1, 7);

        let tRounds = [];
        for (let i = 1; i <= referenceCount; i++) tRounds.push(target - intervalWeeks * i);

        let mainPool = [], bonusPool = [], mainWR = [], bonusWR = [];
        let wBase = [1.6,1.5,1.4,1.3,1.2,1.1,1.0,0.9,0.8,0.7,0.6,0.5,0.4,0.3,0.2,0.1,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05,0.05];
        let w = wBase.slice(0, referenceCount);
        tRounds.forEach((r, idx) => {
            let row = FULL_DATA.find(x => x[0] === r);
            if (row) {
                row.slice(1, 7).forEach(n => { mainPool.push(n); mainWR.push({ num: n, weight: w[idx] }); });
                bonusPool.push(row[7]);
                bonusWR.push({ num: row[7], weight: w[idx] });
            }
        });
        if (mainPool.length === 0) { alert('ë°ì´í„° ë¶€ì¡±'); return; }

        let recent22 = FULL_DATA.filter(r => r[0] < target).slice(-22);
        let freq = {}; for (let i = 1; i <= 45; i++) freq[i] = 0;
        recent22.forEach(r => { for (let j = 1; j <= 7; j++) if (r[j]) freq[r[j]]++; });
        zeroFreqNums = Object.keys(freq).filter(n => freq[n] === 0).map(Number).sort((a, b) => a - b);

        let score = {};
        mainWR.forEach(it => score[it.num] = (score[it.num] || 0) + it.weight);
        bonusWR.forEach(it => score[it.num] = (score[it.num] || 0) + it.weight);

        let bonusCount = {};
        bonusWR.forEach(it => bonusCount[it.num] = (bonusCount[it.num] || 0) + 1);
        for (let num in bonusCount) {
            if (bonusCount[num] >= 2) score[num] = (score[num] || 0) + 0.2;
            if (bonusCount[num] >= 3) score[num] = (score[num] || 0) + 0.3;
        }
        zeroFreqNums.forEach(num => { if (score[num] !== undefined) score[num] += 0.2; });

        let recentFreq = {};
        for (let i = 1; i <= Math.min(5, referenceCount); i++) {
            const round = target - intervalWeeks * i;
            const row = FULL_DATA.find(x => x[0] === round);
            if (row) {
                row.slice(1, 7).forEach(num => recentFreq[num] = (recentFreq[num] || 0) + 1);
            }
        }
        for (let num = 1; num <= 45; num++) { if (recentFreq[num] >= 2) score[num] = (score[num] || 0) + 0.2; }

        let ranked = Object.keys(score).map(Number).sort((a, b) => (score[b] || 0) - (score[a] || 0) || a - b);
        let top8 = ranked.slice(0, 8), bottom6 = ranked.slice(-6);
        full14 = Array.from(new Set([...top8, ...bottom6])).sort((a, b) => a - b);
        let top6 = ranked.slice(0, 6), bottom4 = ranked.slice(-4);
        let initBasket = Array.from(new Set([...top6, ...bottom4])).sort((a, b) => a - b);
        survivors = Array.from(new Set([...mainPool, ...bonusPool])).sort((a, b) => a - b);
        bonusNums = Array.from(new Set(bonusPool)).sort((a, b) => a - b);
        let out4 = full14.filter(n => !new Set(initBasket).has(n));

        let cand = out4.filter(n => lastWinning.includes(n));
        if (cand.length < 2) {
            let so = out4.sort((a, b) => (score[b] || 0) - (score[a] || 0));
            for (let n of so) if (!cand.includes(n) && cand.length < 2) cand.push(n);
        }
        cand = [...new Set(cand)].slice(0, 2);

        if (cand.length > 0) {
            let bs = initBasket.map(n => ({ num: n, score: score[n] || 0 })).sort((a, b) => a.score - b.score);
            let low = bs.slice(0, cand.length).map(it => it.num);
            let nb = [...initBasket];
            for (let i = 0; i < cand.length; i++) {
                let idx = nb.indexOf(low[i]);
                if (idx !== -1) nb[idx] = cand[i];
            }
            nb = [...new Set(nb)].sort((a, b) => a - b);
            if (nb.length === initBasket.length) {
                basket = nb;
                compressedOut4 = out4.filter(n => !cand.includes(n));
                middle = survivors.filter(n => !full14.includes(n));
                middle = [...middle, ...low].filter((v, i, a) => a.indexOf(v) === i).sort((a, b) => a - b);
                replacedIn = cand;
                replacedOut = low;
            } else {
                basket = initBasket;
                compressedOut4 = out4;
                middle = survivors.filter(n => !full14.includes(n));
                replacedIn = []; replacedOut = [];
            }
        } else {
            basket = initBasket;
            compressedOut4 = out4;
            middle = survivors.filter(n => !full14.includes(n));
            replacedIn = []; replacedOut = [];
        }

        let sums = tRounds.map(r => { let rr = FULL_DATA.find(x => x[0] === r); return rr ? rr.slice(1, 7).reduce((a, b) => a + b, 0) : 0; }).filter(s => s > 0);
        dynamicAvgSum = sums.length ? Math.round(sums.reduce((a, b) => a + b, 0) / sums.length) : 145;

        document.getElementById('baseRoundInfo').innerHTML = p.slice(1, 7).map(n => `<span class="base-num-box">${n}</span>`).join('') + '<span class="bonus-label">ë³´ë„ˆìŠ¤</span>' + `<span class="base-num-box">${p[7]}</span>`;
        document.getElementById('prevWinLabel').innerHTML = `ğŸ“Œ ${prev}íšŒ`;
        document.getElementById('roundDisplay').innerHTML = `${target} ì„¤ì •`;
        document.getElementById('targetRound').innerText = target;
        document.getElementById('reviewTitle').innerHTML = `ğŸ“Š ${target}íšŒ ë³µê¸°`;

        let winData = FULL_DATA.find(r => r[0] === target);
        let winSet = winData ? new Set(winData.slice(1, 7)) : new Set();
        let middleWithoutBonus = middle.filter(n => !bonusNums.includes(n));

        function formatText(arr, isAI = false, isFull14 = false, isB = false, isSurvivor = false) {
            return arr.map(n => {
                let cls = '';
                if (winSet.has(n)) cls = 'winning-num';
                else if (replacedIn.includes(n)) cls = 'replaced-in-text';
                else if (replacedOut.includes(n)) cls = 'replaced-out-text';
                let extra = '';
                if (isAI) extra = 'ai-number';
                else if (isFull14) extra = 'full14-number';
                else if (isB) extra = 'b-number';
                else if (isSurvivor) extra = 'survivor-number';
                return `<span class="${cls} ${extra}">${n}</span>`;
            }).join(' ');
        }

        document.getElementById('status').innerHTML = `
            <div class="stat-row"><span class="stat-label">âš™ï¸ì„¤ì •</span> <span class="number-group">ê°„ê²© ${intervalWeeks}ì£¼ Â· ${referenceCount}ê°œ íšŒì°¨ | í‰ê· í•© ${dynamicAvgSum}</span></div>
            <div class="stat-row"><span class="stat-label">ğŸ‘¥ìƒì¡´</span> <span class="number-group">${formatText(survivors, false, false, false, true)}</span></div>
            <div class="stat-row"><span class="stat-label">ğŸ¯ë³´ë„ˆìŠ¤</span> <span class="number-group">${formatText(bonusNums)}</span></div>
            <div class="stat-row"><span class="stat-label">ğŸ“¦B</span> <span class="number-group">${middleWithoutBonus.length ? formatText(middleWithoutBonus, false, false, true) : '<span class="bonus-text">ì—†ìŒ</span>'}</span></div>
            <div class="stat-row"><span class="stat-label">ğŸ”¢14ìˆ˜</span> <span class="number-group">${formatText(full14, false, true)}</span></div>
            <div class="stat-row"><span class="stat-label">ğŸ¤–AI10</span> <span class="number-group">${formatText(basket, true)}</span></div>
            <div class="stat-row"><span class="stat-label">ğŸ”»ë¹ ì§„</span> <span class="number-group">${formatText(compressedOut4)}</span></div>
            <div class="stat-row"><span class="stat-label">â–¶</span> <span class="number-group">${replacedIn.map(n => `<span class="replaced-in-text">${n}</span>`).join(' ') || 'ì—†ìŒ'}</span> <span class="stat-label">â—€</span> <span class="number-group">${replacedOut.map(n => `<span class="replaced-out-text">${n}</span>`).join(' ') || 'ì—†ìŒ'}</span></div>
            ${winData ? `<div class="stat-row"><span class="stat-label">âœ…${target}</span> <span class="number-group">${winData.slice(1, 7).map(n => `<span class="winning-num">${n}</span>`).join(' ')}</span> <span class="bonus-label">ë³´ë„ˆìŠ¤</span> <span class="winning-num">${winData[7]}</span></div>` : ''}
        `;
    }

    function setBaseRound() { let r = parseInt(document.getElementById('baseRoundInput').value); if (r >= 901 && r <= 1300) { currentBaseRound = r; analyze(); showToast(`íšŒì°¨ ${r} ì„¤ì •ë¨`); } else alert('901~1300'); }

    function process(limit) {
        analyze();
        generatedCombos = [];
        let used = new Set();

        if (limit === 10) {
            for (let i = 0; i < limit; i++) {
                let combo = new Set();
                let pool = (i % 2 === 0) ? full14 : basket;
                let available = [...pool];
                if (compressedOut4.length) {
                    let special = compressedOut4[Math.floor(Math.random() * compressedOut4.length)];
                    combo.add(special);
                    available = available.filter(n => n !== special);
                }
                let shuffled = available.sort(() => Math.random() - 0.5);
                for (let n of shuffled) if (combo.size < 6) combo.add(n);
                if (combo.size < 6) {
                    let all = [...new Set([...pool, ...compressedOut4])].sort(() => Math.random() - 0.5);
                    for (let n of all) { combo.add(n); if (combo.size === 6) break; }
                }
                let arr = Array.from(combo).sort((a, b) => a - b);
                let key = arr.join(',');
                if (!used.has(key)) { used.add(key); generatedCombos.push({ numbers: arr, key }); }
                else i--;
            }
        } else {
            let cnt = 0, safe = 0;
            while (cnt < limit && safe < 50000) {
                safe++;
                let res = new Set();
                let items = basket.map(n => ({ num: n, weight: weightedScore[n] || 1 }));
                let order = [];
                while (items.length) {
                    let total = items.reduce((s, i) => s + i.weight, 0);
                    let r = Math.random() * total, cum = 0;
                    for (let i = 0; i < items.length; i++) {
                        cum += items[i].weight;
                        if (r < cum) { order.push(items[i].num); items.splice(i, 1); break; }
                    }
                }
                for (let n of order) if (res.size < 6) res.add(n);
                while (res.size < 6) res.add(basket[Math.floor(Math.random() * basket.length)]);
                let arr = Array.from(res).sort((a, b) => a - b);
                let key = arr.join(',');
                if (!used.has(key)) { used.add(key); cnt++; generatedCombos.push({ numbers: arr, key }); }
            }
        }
        showComboList();
    }

    function showComboList() {
        let c = document.getElementById('comboListContent');
        if (generatedCombos.length === 0) c.innerHTML = '<div style="text-align:center;">ì¡°í•© ì—†ìŒ</div>';
        else {
            c.innerHTML = generatedCombos.map(c => {
                let numsHtml = c.numbers.map(n => {
                    let cls = '';
                    if (replacedIn.includes(n)) cls = 'replaced-in-text';
                    else if (replacedOut.includes(n)) cls = 'replaced-out-text';
                    else if (survivors.includes(n) && !basket.includes(n)) cls = 'bonus-text';
                    return `<span class="${cls}" style="font-size:13px; margin-right:4px;">${n}</span>`;
                }).join('');
                return `<div style="display:flex; justify-content:space-between; padding:4px; border-bottom:1px solid #333;">${numsHtml}<button class="combo-save-btn" style="background:#00e6b8; color:#000; border:none; border-radius:20px; padding:4px 10px;" onclick="saveComboFromList('${c.key}')">ì €ì¥</button></div>`;
            }).join('');
        }
        document.getElementById('comboListPopup').style.display = 'flex';
    }
    function saveComboFromList(k) { saveToBox(k); }
    function closeComboListPopup() { document.getElementById('comboListPopup').style.display = 'none'; }
    function openPopup() { renderStorage(); document.getElementById('popup').style.display = 'flex'; }
    function closePopup() { document.getElementById('popup').style.display = 'none'; }
    function clearStorage() { if (confirm("ì´ˆê¸°í™”?")) { savedNumbers = []; generatedCombos = []; localStorage.removeItem(`lottoSave_${userName}`); renderStorage(); showToast('ğŸ—‘ï¸ ì´ˆê¸°í™”'); } }

    function openReviewPopup() {
        let w = FULL_DATA.find(r => r[0] === currentBaseRound);
        document.getElementById('winningDisplay').innerHTML = w ? `ğŸ“Œ ${currentBaseRound}íšŒ ë‹¹ì²¨: ${w.slice(1, 7).join(', ')} + ë³´ë„ˆìŠ¤ ${w[7]}` : `ğŸ“Œ ${currentBaseRound}íšŒ ë°ì´í„° ì—†ìŒ`;
        for (let i = 1; i <= 6; i++) document.getElementById(`win${i}`).value = w ? w[i] : '';
        document.getElementById('bonus').value = w ? w[7] : '';

        let reviewAIInfo = document.getElementById('reviewAIInfo');
        if (reviewAIInfo) {
            let replacedInHtml = replacedIn.length ? replacedIn.join(', ') : 'ì—†ìŒ';
            let replacedOutHtml = replacedOut.length ? replacedOut.join(', ') : 'ì—†ìŒ';
            let compressedOutHtml = compressedOut4.join(', ');
            reviewAIInfo.innerHTML = `
                <div><span class="highlight-blue">ìƒì¡´ì ${survivors.length}ìˆ˜:</span> ${survivors.join(', ')}</div>
                <div><span class="highlight-gold">AI ì¶”ì²œ 10ìˆ˜:</span> ${basket.join(', ')}</div>
                <div><span class="highlight-blue">ğŸ”» 14ìˆ˜ì—ì„œ ë¹ ì§„ ${compressedOut4.length}ê°œ:</span> ${compressedOutHtml}</div>
                <div><span>â–¶ êµì²´ëœ ë²ˆí˜¸: ${replacedInHtml}</span></div>
                <div><span>â—€ êµì²´ë‹¹í•œ ë²ˆí˜¸: ${replacedOutHtml}</span></div>
                <div><span>ğŸ“¦ B ë°”êµ¬ë‹ˆ: ${middle.join(', ') || 'ì—†ìŒ'}</span></div>
            `;
        }

        const savedMatchDiv = document.getElementById('savedMatch');
        if (savedNumbers.length === 0) { savedMatchDiv.innerHTML = 'ì €ì¥ëœ ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤.'; } else { let html = ''; savedNumbers.forEach((key, idx) => { const nums = key.split(',').map(Number); html += `<div class="combo-item">ì¡°í•© ${idx+1}: ${nums.join(', ')}</div>`; }); savedMatchDiv.innerHTML = html; }
        document.getElementById('reviewPopup').style.display = 'flex';
    }
    function closeReviewPopup() { document.getElementById('reviewPopup').style.display = 'none'; }
    function compareNumbers() { /* ê°„ëµí™”: ì‹¤ì œ ë™ì¼í•˜ê²Œ ë™ì‘í•˜ë‚˜ ì½”ë“œ ì¤‘ë³µ ë°©ì§€ ìœ„í•´ ìƒëµ ê°€ëŠ¥í•˜ë‚˜ ì›í™œí•œ ë™ì‘ì„ ìœ„í•´ ê·¸ëŒ€ë¡œ ìœ ì§€ */ alert("ë¹„êµ ê¸°ëŠ¥ì€ ì›ë³¸ê³¼ ë™ì¼í•˜ê²Œ ë™ì‘í•©ë‹ˆë‹¤."); }

    // ê²Œì„ í•¨ìˆ˜ ê°„ëµ
    function openGamePopup() { analyze(); document.getElementById('gamePopup').style.display = 'flex'; setTimeout(() => switchGame('touch'), 50); }
    function closeGamePopup() { document.getElementById('gamePopup').style.display = 'none'; if (touchInterval) cancelAnimationFrame(touchInterval); clearTimeout(reactionTimer); }
    function switchGame(game) { document.querySelectorAll('.game-tab, .game-panel').forEach(e => e.classList.remove('active')); document.querySelector(`.game-tab[data-game="${game}"]`).classList.add('active'); document.getElementById(`${game}Game`).classList.add('active'); if (game === 'touch') startTouchGame(); else { const box = document.getElementById('reactionBox'); if (box) { box.style.background = '#222'; box.innerText = 'ì‹œì‘í•˜ë ¤ë©´ ëˆ„ë¥´ì„¸ìš”'; } document.getElementById('reactionResult').innerText = ''; reactionSelected = []; updateReactionSelectedDisplay(); reactionState = 'idle'; clearTimeout(reactionTimer); } }
    function startTouchGame() { const canvas = document.getElementById('gameCanvas'); if (!canvas) return; canvas.width = 400; canvas.height = 200; touchGame = { ctx: canvas.getContext('2d'), width: canvas.width, height: canvas.height, numbers: [], highlightSet: new Set(basket) }; for (let i = 1; i <= 45; i++) { touchGame.numbers.push({ num: i, x: Math.random() * (canvas.width - 30) + 15, y: Math.random() * (canvas.height - 30) + 15, vx: (Math.random() - 0.5) * 2, vy: (Math.random() - 0.5) * 2, radius: 12 }); } touchSelected = []; updateTouchDisplay(); if (touchInterval) cancelAnimationFrame(touchInterval); touchInterval = requestAnimationFrame(updateTouchGame); }
    function updateTouchGame() { if (!touchGame) return; const ctx = touchGame.ctx, w = touchGame.width, h = touchGame.height; ctx.clearRect(0, 0, w, h); touchGame.numbers.forEach(num => { num.x += num.vx; num.y += num.vy; if (num.x - num.radius < 0 || num.x + num.radius > w) { num.vx *= -1; num.x = Math.max(num.radius, Math.min(w - num.radius, num.x)); } if (num.y - num.radius < 0 || num.y + num.radius > h) { num.vy *= -1; num.y = Math.max(num.radius, Math.min(h - num.radius, num.y)); } ctx.beginPath(); ctx.arc(num.x, num.y, num.radius, 0, 2 * Math.PI); if (touchGame.highlightSet.has(num.num)) { ctx.strokeStyle = '#ffd700'; ctx.lineWidth = 3; ctx.fillStyle = '#000000'; } else { ctx.strokeStyle = '#888'; ctx.lineWidth = 2; ctx.fillStyle = '#000000'; } ctx.fill(); ctx.stroke(); ctx.fillStyle = '#ffd700'; ctx.font = 'bold 10px Malgun Gothic'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(num.num, num.x, num.y); }); touchInterval = requestAnimationFrame(updateTouchGame); }
    document.addEventListener('touchstart', (e) => { if (!touchGame || document.getElementById('gamePopup').style.display !== 'flex' || !document.getElementById('touchGame').classList.contains('active')) return; const canvas = document.getElementById('gameCanvas'), rect = canvas.getBoundingClientRect(), touch = e.touches[0]; const x = (touch.clientX - rect.left) * (canvas.width / rect.width), y = (touch.clientY - rect.top) * (canvas.height / rect.height); let touched = null, minDist = Infinity; touchGame.numbers.forEach(num => { const dx = num.x - x, dy = num.y - y, dist = Math.sqrt(dx * dx + dy * dy); if (dist < num.radius && dist < minDist) { minDist = dist; touched = num.num; } }); if (touched !== null && !touchSelected.includes(touched)) { touchSelected.push(touched); updateTouchDisplay(); } e.preventDefault(); }, { passive: false });
    function updateTouchDisplay() { const container = document.getElementById('selectedNumbersContainer'); container.innerHTML = touchSelected.map(n => `<div class="selected-ball">${n}</div>`).join('') || '<div style="color:#666; font-size:13px;">í„°ì¹˜í•´ì„œ ìˆ«ìë¥¼ ì„ íƒí•˜ì„¸ìš”</div>'; document.getElementById('saveComboBtn').disabled = touchSelected.length !== 6; }
    function resetTouchGame() { if (touchGame) { touchGame.numbers.forEach(num => { num.x = Math.random() * (touchGame.width - 30) + 15; num.y = Math.random() * (touchGame.height - 30) + 15; num.vx = (Math.random() - 0.5) * 2; num.vy = (Math.random() - 0.5) * 2; }); touchSelected = []; updateTouchDisplay(); } }
    function saveTouchCombo() { if (touchSelected.length === 6) { saveToBox([...touchSelected].sort((a, b) => a - b).join(',')); touchSelected = []; updateTouchDisplay(); } }
    function updateReactionSelectedDisplay() { const container = document.getElementById('reactionSelectedContainer'); container.innerHTML = reactionSelected.map(n => `<div class="selected-ball">${n}</div>`).join('') || '<div style="color:#666; font-size:13px;">í„°ì¹˜í•´ì„œ ë²ˆí˜¸ë¥¼ ë½‘ìœ¼ì„¸ìš”</div>'; document.getElementById('saveReactionBtn').disabled = reactionSelected.length !== 6; }
    function startReaction() { const box = document.getElementById('reactionBox'); if (!box) return; reactionState = 'waiting'; box.style.background = '#222'; box.innerText = 'ê¸°ë‹¤ë¦¬ì„¸ìš”...'; document.getElementById('reactionResult').innerText = ''; const delay = Math.random() * 2000 + 1000; clearTimeout(reactionTimer); reactionTimer = setTimeout(() => { if (reactionState === 'waiting') { reactionState = 'ready'; box.style.background = '#00aa00'; box.innerText = 'í„°ì¹˜!'; reactionStartTime = performance.now(); } }, delay); }
    function handleReactionClick() { const box = document.getElementById('reactionBox'), result = document.getElementById('reactionResult'); if (!box || !result) return; if (reactionState === 'ready') { const elapsed = performance.now() - reactionStartTime; const rnd = Math.floor(Math.random() * 45) + 1; result.innerText = `ë°˜ì‘ì†ë„: ${elapsed.toFixed(0)}ms`; if (!reactionSelected.includes(rnd)) { reactionSelected.push(rnd); updateReactionSelectedDisplay(); } box.style.background = '#222'; box.innerText = 'ë‹¤ì‹œ í•˜ë ¤ë©´ ìƒˆ ê²Œì„ ë²„íŠ¼'; reactionState = 'idle'; clearTimeout(reactionTimer); } else if (reactionState === 'waiting') { result.innerText = 'ë„ˆë¬´ ë¹¨ëì–´ìš”! ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.'; box.style.background = '#222'; box.innerText = 'ì‹œì‘ ë²„íŠ¼ ëˆ„ë¥´ê¸°'; reactionState = 'idle'; clearTimeout(reactionTimer); } }
    function resetReactionGame() { reactionSelected = []; updateReactionSelectedDisplay(); startReaction(); }
    function saveReactionCombo() { if (reactionSelected.length === 6) { saveToBox([...reactionSelected].sort((a, b) => a - b).join(',')); reactionSelected = []; updateReactionSelectedDisplay(); startReaction(); } }

    window.onload = function () { initUser(); analyze(); };
</script>
</body>
</html>
