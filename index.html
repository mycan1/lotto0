// GitHubì— ì˜¬ë¦° ë°ì´í„° íŒŒì¼ ê²½ë¡œ (ë³¸ì¸ ê³„ì •ì— ë§ì¶° ìˆ˜ì • ê°€ëŠ¥)
const DATA_URL = 'https://raw.githubusercontent.com/ì‚¬ìš©ìëª…/ì €ì¥ì†Œëª…/main/data.json';

async function process(mode) {
    const box = document.getElementById('console');
    box.innerHTML = `â–¶ [ë°ì´í„° ë¡œë“œ ì¤‘...]\n`;

    try {
        // 1. ì™¸ë¶€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        const response = await fetch(DATA_URL);
        const data = await response.json();
        
        // ë°ì´í„° ì „ì—­ ë³€ìˆ˜í™” (ê°€ì ¸ì˜¨ ë°ì´í„° êµ¬ì¡°ì— ë§ê²Œ ë§¤í•‘)
        const globalLottoData = data.lottoHistory; 
        const missingWeightPool = data.weightPool;

        box.innerHTML = `â–¶ [ì‚¬ì¥ë‹˜ ì›ë³¸ ë¶„ì„ë²• ì „ìˆ˜ì¡°ì‚¬ ì‹œì‘]\n--------------------------\n`;

        let count = parseInt(mode);
        let gen = 0, safety = 0;

        // 2. ìµœê·¼ 30íšŒ ë¯¸ì¶œìˆ˜ ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ
        const recent30Nums = new Set(globalLottoData.slice(0, 30).flatMap(row => row.slice(1, 7)));
        const pureMissing30 = Array.from({length: 45}, (_, i) => i + 1).filter(n => !recent30Nums.has(n));

        while(gen < count && safety < 500000) { 
            safety++;
            let candidateSet = new Set();
            
            // ğŸ¯ [ì‚¬ì¥ë‹˜ ë¶„ì„ë²• í•µì‹¬] íšŒì°¨ë³„ ë¯¸ì¶œìˆ˜ ê°•ì œ íˆ¬ì…
            let requiredMissingCount = 0;
            if (gen === 7) requiredMissingCount = 1;      
            else if (gen === 8) requiredMissingCount = 2; 
            else if (gen === 9) requiredMissingCount = 2; 

            if (requiredMissingCount > 0) {
                let mPicks = [...pureMissing30].sort(() => Math.random() - 0.5).slice(0, requiredMissingCount);
                mPicks.forEach(n => candidateSet.add(n));
            }

            while(candidateSet.size < 6) {
                let idx = Math.floor(Math.random() * missingWeightPool.length);
                candidateSet.add(missingWeightPool[idx]);
            }
            
            let candidate = Array.from(candidateSet).sort((a,b) => a-b);
            let sum = candidate.reduce((a,b) => a+b, 0);
            let ac = calculateAC(candidate); // ë³„ë„ ì •ì˜ëœ í•¨ìˆ˜ í•„ìš”
            
            // 3. ì›ë³¸ í•„í„° (í•©ê³„ 100~175, AC 5ì´ìƒ, 3ì—°ë²ˆ ê¸ˆì§€)
            let isSerial = false;
            for(let i=0; i<4; i++) { 
                if(candidate[i]+1 === candidate[i+1] && candidate[i+1]+1 === candidate[i+2]) isSerial = true; 
            }

            if (sum >= 100 && sum <= 175 && ac >= 5 && !isSerial) {
                gen++;
                let s = candidate.map(n => n < 10 ? "0"+n : n).join("  ");
                let style = gen >= 8 ? "style='color:#FFD700; font-weight:bold;'" : "";
                let icon = gen >= 8 ? "ğŸ”¥" : "â­";
                box.innerHTML += `<div ${style}>${icon} ${gen < 10 ? "0"+gen : gen} :  ${s}</div>`;
            }
        }
        box.scrollTop = box.scrollHeight;

    } catch (error) {
        box.innerHTML += `<div style="color:red;">âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}</div>`;
    }
}
