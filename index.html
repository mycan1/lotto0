function process(limit) {
    analyze();
    generatedCombos = [];
    let count = 0, used = new Set(), safety = 0;
    let minSum = dynamicAvgSum - 25;
    let maxSum = dynamicAvgSum + 25;

    while(count < limit && safety < 10000) {
        safety++;
        let res = new Set();
        let currentIdx = count + 1;
        let zeroCount = 0;

        // íŠ¹ìˆ˜ ê·œì¹™: 5ì¡°í•© 5ë²ˆì§¸ì— B bagì—ì„œ 2ê°œ í¬í•¨
        if (limit === 5 && currentIdx === 5 && middle.length >= 2) {
            let shuffled = [...middle].sort(() => Math.random() - 0.5);
            for (let i = 0; i < 2; i++) res.add(shuffled[i]);
        }
        // 10ì¡°í•© 9,10ë²ˆì§¸ì— B bagì—ì„œ 2ê°œì”© í¬í•¨
        if (limit === 10 && (currentIdx === 9 || currentIdx === 10) && middle.length >= 2) {
            let shuffled = [...middle].sort(() => Math.random() - 0.5);
            for (let i = 0; i < 2; i++) res.add(shuffled[i]);
        }

        // ë¯¸ì¶œìˆ˜ í¬í•¨ (10ì¡°í•© 9,10ë²ˆì§¸ì—ë§Œ)
        if (limit === 10 && (currentIdx === 9 || currentIdx === 10) && zeroFreqNums.length > 0) {
            let availableZeros = [...zeroFreqNums].filter(n => !res.has(n));
            let maxPossible = Math.min(4, availableZeros.length);
            let selectCount = Math.floor(Math.random() * maxPossible) + 1;
            for(let i = 0; i < selectCount; i++) {
                if(availableZeros.length === 0) break;
                let randomIndex = Math.floor(Math.random() * availableZeros.length);
                let selectedNum = availableZeros[randomIndex];
                res.add(selectedNum);
                zeroCount++;
                availableZeros.splice(randomIndex, 1);
            }
        } else if (Math.random() > 0.8 && zeroFreqNums.length > 0 && zeroCount < 2) {
            // ì¼ë°˜ ì¡°í•©ì—ì„œë„ ê°€ë” ë¯¸ì¶œìˆ˜ í¬í•¨
            let zeroNum = zeroFreqNums[Math.floor(Math.random() * zeroFreqNums.length)];
            res.add(zeroNum);
            zeroCount++;
        }

        // 5ì¡°í•©ì—ëŠ” ê¸°ê³„ ê³ ì • ë²ˆí˜¸ 1ê°œ ì¶”ê°€ (13ìˆ˜ ë‚´)
        if(limit === 5) res.add(basket[Math.floor(Math.random() * basket.length)]);

        // ì´ì œ ë‚¨ì€ ìë¦¬ë¥¼ 13ìˆ˜(basket)ì—ì„œ ê°€ì¤‘ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ì±„ì›€
        let availableBasket = [...basket].filter(n => !res.has(n));
        // ê°€ì¤‘ì¹˜ ê¸°ë°˜ ëœë¤ ìˆœì„œ ìƒì„±
        let weightedItems = availableBasket.map(n => ({ num: n, weight: weightedScore[n] || 1 }));
        let weightedOrder = [];
        while (weightedItems.length > 0) {
            let total = weightedItems.reduce((sum, item) => sum + item.weight, 0);
            let rand = Math.random() * total;
            let cum = 0;
            for (let i = 0; i < weightedItems.length; i++) {
                cum += weightedItems[i].weight;
                if (rand < cum) {
                    weightedOrder.push(weightedItems[i].num);
                    weightedItems.splice(i, 1);
                    break;
                }
            }
        }
        // ìˆœì„œëŒ€ë¡œ ì¶”ê°€ (zeroCount ì¡°ê±´ ê³ ë ¤, ë¯¸ì¶œìˆ˜ëŠ” ì´ë¯¸ ì²˜ë¦¬ë¨)
        for (let n of weightedOrder) {
            if (res.size >= 6) break;
            res.add(n);
        }

        // ê·¸ë˜ë„ ëª¨ìë¼ë©´ 13ìˆ˜ ë‚´ì—ì„œ ëœë¤ìœ¼ë¡œ ì±„ì›€
        while(res.size < 6) {
            let remaining = [...basket].filter(n => !res.has(n));
            if (remaining.length === 0) break; // ì´ë¡ ìƒ ë°œìƒ ì•ˆ í•¨
            let randIndex = Math.floor(Math.random() * remaining.length);
            res.add(remaining[randIndex]);
        }

        let finalArr = Array.from(res).sort((a,b)=>a-b);
        let sum = finalArr.reduce((a,b)=>a+b, 0);
        let key = finalArr.join(',');

        // í•©ê³„ ì¡°ê±´ë§Œ ê²€ì‚¬
        if (!used.has(key) && sum >= minSum && sum <= maxSum) {
            used.add(key);
            count++;
            // íŠ¹ìˆ˜ ì¡°í•© ë§ˆí¬ (ì´ì œ B bagë§Œ ì‚¬ìš©í•˜ì§€ë§Œ, êµ¬ë¶„ì„ ìœ„í•´ ìœ ì§€)
            let specialMark = '';
            if (limit === 10 && (count === 9 || count === 10)) specialMark = 'ğŸ”¥';
            if (limit === 5 && count === 5) specialMark = 'âš¡';
            generatedCombos.push({
                numbers: finalArr,
                key: key,
                mark: specialMark,
                comboNumber: count
            });
        }
    }
    showComboList();
}
