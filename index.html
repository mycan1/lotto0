import tkinter as tk
from tkinter import messagebox, ttk
import collections

class LottoUnifiedSystem:
    def __init__(self, root):
        self.root = root
        self.root.title("0000 HIGH-PRECISION SYSTEM (1213)")
        self.root.geometry("600x750")
        self.root.configure(bg="#24292e") # 깃허브 다크 테마 적용

        # --- [Header 디자인] ---
        self.header = tk.Frame(root, bg="#1a1d21", height=60)
        self.header.pack(fill="x")
        tk.Label(self.header, text="CORE ENGINE v1213", fg="#58a6ff", bg="#1a1d21", 
                 font=("Arial", 16, "bold")).pack(pady=15)

        # --- [이월수 입력 섹션] ---
        self.input_frame = tk.LabelFrame(root, text=" 1212회 당첨번호 (이월수 분석) ", 
                                         fg="#8b949e", bg="#24292e", font=("Arial", 10))
        self.input_frame.pack(fill="x", padx=20, pady=10)
        
        self.last_win_entry = tk.Entry(self.input_frame, bg="#0d1117", fg="#c9d1d9", 
                                       insertbackground="white", justify='center', font=("Arial", 12))
        self.last_win_entry.insert(0, "1, 7, 10, 12, 14, 18") # 1212회 예시
        self.last_win_entry.pack(fill="x", padx=10, pady=10)

        # --- [메인 버튼 디자인] ---
        self.btn_run = tk.Button(root, text="1213회 정예 17수 추출", command=self.analyze_1213,
                                 bg="#238636", fg="white", font=("Arial", 12, "bold"), 
                                 activebackground="#2ea44f", cursor="hand2", relief="flat")
        self.btn_run.pack(fill="x", padx=20, pady=15)

        # --- [결과 출력 (공 디자인)] ---
        self.result_label = tk.Label(root, text="[ 분석 대기 중 ]", fg="#8b949e", bg="#24292e")
        self.result_label.pack()
        
        self.ball_canvas = tk.Canvas(root, bg="#0d1117", height=180, highlightthickness=0)
        self.ball_canvas.pack(fill="x", padx=20, pady=10)

        # --- [보관함 섹션] ---
        tk.Label(root, text="전략 보관함 (Selected List)", fg="#58a6ff", bg="#24292e", font=("bold")).pack()
        self.storage_list = tk.Listbox(root, bg="#0d1117", fg="#c9d1d9", height=8, font=("Courier", 10))
        self.storage_list.pack(fill="x", padx=20, pady=5)

    # --- [0000 핵심 엔진: 깃허브 분석법 삭제 후 이식] ---
    def analyze_1213(self):
        try:
            # 1212회 이월수 파싱
            last_win = [int(x.strip()) for x in self.last_win_entry.get().split(',')]
        except:
            messagebox.showerror("Error", "1212회 번호를 정확히 입력하세요.")
            return

        # 1213회 전용 52주 주기 데이터 (사용자 요청 5개 회차 반영)
        cycle_data = {
            1161: [4, 5, 12, 16, 22, 35, 34], 1109: [10, 12, 13, 19, 33, 40, 2],
            1057: [8, 13, 19, 27, 40, 45, 12], 1005: [8, 13, 18, 24, 27, 29, 17],
            953: [7, 9, 22, 27, 37, 42, 34]
        }

        # [핵심 로직] 주기 빈도 계산
        main_pool = []
        for r in cycle_data: main_pool.extend(cycle_data[r][:6])
        counts = collections.Counter(main_pool)
        survivors = list(set(main_pool + [row[6] for row in cycle_data.values()]))

        # [핵심 로직] 이월수 우선 승격 정렬
        final_list = sorted(survivors, key=lambda x: (x in last_win, counts.get(x, 0), -x), reverse=True)
        
        # 17수 확정 및 보관함 자동 저장
        res_17 = sorted(final_list[:17])
        self.draw_balls(res_17)
        self.storage_list.insert(0, f"1213회 정예: {res_17}")
        self.result_label.config(text="1213회차 분석 완료", fg="#56d364")

    # --- [디자인: 깃허브 스타일 공 그리기] ---
    def draw_balls(self, nums):
        self.ball_canvas.delete("all")
        x_start, y_start = 40, 40
        for i, n in enumerate(nums):
            color = "#f1e05a" if n <= 10 else "#58a6ff" if n <= 20 else "#f85149" if n <= 30 else "#d29922" if n <= 40 else "#3fb950"
            col, row = i % 6, i // 6
            x, y = x_start + (col * 85), y_start + (row * 65)
            self.ball_canvas.create_oval(x-25, y-25, x+25, y+25, fill=color, outline="white", width=2)
            self.ball_canvas.create_text(x, y, text=str(n), fill="black" if n <= 10 else "white", font=("Arial", 12, "bold"))

if __name__ == "__main__":
    root = tk.Tk(); app = LottoUnifiedSystem(root); root.mainloop()
